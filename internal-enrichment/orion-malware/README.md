# OpenCTI Orion Malware Connector

This connector supports enrichment of observables via Orion Malware.
* [Orion Malware](https://www.cyber.airbus.com/fr/orion-malware/)

The connector works for the following observable types:

* Artifact
* File
* Report

The STIX observables that can be created are:
* IP Address
* Domain Name
* HTTP request
* URL

A grouping object and a malware analysis object are automatically created with all STIX relations between them.

## Installation

Enabling this connector could be done by launching the Python process directly
after providing the correct configuration in the `config.yml` file or within a
Docker with the image `opencti/connector-orion-malware:latest`.

We provide an example of [`docker-compose.yml`](docker-compose.yml) file that
could be used independently or integrated to the global `docker-compose.yml`
file of OpenCTI.

## Behavior

This connector will submit the observable for analysis, wait for it to finish,
and create relationships between the Artifact and any contacted ip, domain, or url. 
The connector also provide relationship between the Artifact and TTP used by malware.
The TTP are provided by the MITRE Connector.
Labels are created for associated Antivirus signatures and Yara rule matches.
An external reference will contain all the analysis reports. The following
list represents the supported list of analysis reports:

## Configuration


| Parameter                                             | Docker envvar                                         | Mandatory | Description                                                                                                                                                                                          |
|-------------------------------------------------------|-------------------------------------------------------|-----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `opencti_url`                                         | `OPENCTI_URL`                                         | Yes       | The URL of the OpenCTI platform.                                                                                                                                                                     |
| `opencti_token`                                       | `OPENCTI_TOKEN`                                       | Yes       | The default admin token configured in the OpenCTI platform parameters file.                                                                                                                          |
| `opencti_organisations`                               | `OPENCTI_ORGANISATIONS`                               | No        | The organisation name in OpenCTI and the corresponding API key in Orion. Must be "organistion_name:orion_apikey,organistion_name2:orion_apikey2 ..." (This is used to preserved the "Right to Know") |
| `connector_id`                                        | `CONNECTOR_ID`                                        | Yes       | A valid arbitrary `UUIDv4` that must be unique for this connector.                                                                                                                                   |
| `connector_type`                                      | `CONNECTOR_TYPE`                                      | Yes       | Must be `INTERNAL_ENRICHMENT` (this is the connector type).                                                                                                                                          |
| `connector_name`                                      | `CONNECTOR_NAME`                                      | Yes       | The name of the Orion instance, to identify it if you have multiple Orion connectors.                                                                                                                |
| `connector_scope`                                     | `CONNECTOR_SCOPE`                                     | Yes       | Must be one of all of those `StixFile,Artifact,Report`.                                                                                                                                              |
| `connector_confidence_level`                          | `CONNECTOR_CONFIDENCE_LEVEL`                          | Yes       | The default confidence level for created relationships (a number between 1 and 4).                                                                                                                   |
| `connector_add_label`                                 | `CONNECTOR_ADD_LABEL`                                 | Yes       | The connector will create label on analysed artifact (AV signatures, rules based trigger ...)                                                                                                        |
| `connector_log_level`                                 | `CONNECTOR_LOG_LEVEL`                                 | Yes       | The log level for this connector, could be `debug`, `info`, `warn` or `error` (less verbose).                                                                                                        |
| `orion_malware_url`                                   | `ORION_MALWARE_URL`                                   | Yes       | The Orion instance URL.                                                                                                                                                                              |
| `orion_malware_verify_ssl`                            | `ORION_MALWARE_VERIFY_SSL`                            | Yes       | A boolean (`True` or `False`), check if the SSL certificate is valid when using `https`.                                                                                                             |
| `orion_malware_api_timeout`                           | `ORION_MALWARE_API_TIMEOUT`                           | Yes       | The Orion Malware Api timeout.                                                                                                                                                                       |
| `orion_malware_default_tlp`                           | `ORION_MALWARE_DEFAULT_TLP`                           | Yes       | Default TLP to use for created observables (ex : TLP:CLEAR, TLP:GREEN, TLP:AMBER, TLP:RED)                                                                                                           |
| `orion_malware_tlp_red_visibility`                    | `ORION_MALWARE_TLP_RED_VISIBILITY`                    | Yes       | Visibility in Orion for analysis report of Artefact / File with Red TLP in OpenCTI                                                                                                                   |
| `orion_malware_tlp_amber_and_amber_strict_visibility` | `ORION_MALWARE_TLP_AMBER_AND_AMBER_STRICT_VISIBILITY` | Yes       | Visibility in Orion for analysis report of Artefact / File with Amber or Amber+Strict TLP in OpenCTI                                                                                                 |
| `orion_malware_tlp_clear_and_green_visibility`        | `ORION_MALWARE_TLP_CLEAR_AND_GREEN_VISIBILITY`        | Yes       | Visibility in Orion for analysis report of Artefact / File with Green or Clear TLP in OpenCTI                                                                                                        |
| `orion_malware_default_api_key`                       | `ORION_MALWARE_DEFAULT_API_KEY`                       | Yes       | The default Orion API key to use (if no organisation)                                                                                                                                                |
