version: '3'
services:
  connector-microsoft-defender-intel-synchronizer:
    image: opencti/connector-microsoft-defender-intel-synchronizer:latest
    environment:
      OPENCTI_URL: http://localhost
      OPENCTI_TOKEN: ChangeMe
      CONNECTOR_ID: ChangeMe
      CONNECTOR_NAME: "Microsoft Defender Intel Synchronizer"
      CONNECTOR_SCOPE: sentinel # MIME type or Stix Object - Not used
      CONNECTOR_LOG_LEVEL: error

      # Microsoft Entra / Defender API credentials
      MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_TENANT_ID: ChangeMe
      MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_CLIENT_ID: ChangeMe
      MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_CLIENT_SECRET: ChangeMe
      MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_LOGIN_URL: https://login.microsoftonline.com
      MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_BASE_URL: https://api.securitycenter.microsoft.com
      MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_RESOURCE_PATH: /api/indicators

      # Global defaults
      MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_EXPIRE_TIME: 30                        # Default indicator TTL (days)
      MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_ACTION: Audit                          # Default action if not overridden
      MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_INTERVAL: 300                          # Sync interval (seconds)
      MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_UPDATE_ONLY_OWNED: true                # Manage only owned indicators
      MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_PASSIVE_ONLY: false                    # Emulate-only mode if true
      MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_RBAC_GROUP_NAMES: '["Default Group"]'  # Optional global RBAC group scope
      MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_MAX_INDICATORS: 15000                  # Global cap; Defender supports up to 15,000 indicators


      # TAXII configuration (choose one style)

      ## 1. Simple list (use connector defaults for all collections)
      # MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_TAXII_COLLECTIONS: COLLECTION1,COLLECTION2

      ## 2. Advanced per-collection configuration (JSON map)
      MICROSOFT_DEFENDER_INTEL_SYNCHRONIZER_TAXII_COLLECTIONS: >-
        {
          "COLLECTION1": {
            "action": "Block",
            "expire_time": 7,
            "recommended_actions": "Block immediately",
            "educate_url": "https://support.example.com",
            "rbac_group_names": ["Linux Servers","Production"]
          },
          "COLLECTION2": {
            "action": "Audit",
            "expire_time": 30
          }
        }

    restart: always
