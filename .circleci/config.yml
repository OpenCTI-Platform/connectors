version: 2.1
orbs:
  slack: circleci/slack@4.13.3
  ms-teams: cloudradar-monitoring/ms-teams@0.0.1
jobs:
  ensure_formatting:
    docker:
      - image: cimg/python:3.11
    working_directory: ~/repo
    steps:
      - checkout
      - run: sudo apt-get update -qq && sudo apt install curl gettext-base
      - run:
          name: install dependencies
          command: pip install black isort --user
      - run:
          name: confirm black version
          command: black --version
      - run:
          name: run isort check
          command: isort --profile black --check .
      - run:
          name: run black check
          command: black --check .
      - slack/notify:
          event: fail
          template: basic_fail_1
      - ms-teams/report:
          only_on_fail: true
          webhook_url: $MS_TEAMS_WEBHOOK_URL
  linter:
    docker:
      - image: alpine/flake8
    working_directory: ~/repo
    steps:
      - checkout
      - run: apk update && apk upgrade && apk --no-cache add curl gettext
      - run:
          name: flake8
          command: flake8 --ignore=E,W ~/repo
      - slack/notify:
          event: fail
          template: basic_fail_1
      - ms-teams/report:
          only_on_fail: true
          webhook_url: $MS_TEAMS_WEBHOOK_URL
  test:
    docker:
      - image: cimg/python:3.11
    working_directory: ~/repo
    steps:
      - checkout
      - run: sudo apt-get update -qq && sudo apt install curl gettext-base
      - run:
          name: install dependencies
          command: pip install pytest --user
      - run:
          name: Run tests
          command: bash run_test.sh
  build_1:
    working_directory: ~/opencti
    docker:
      - image: cimg/base:stable-20.04
    steps:
      - checkout
      - setup_remote_docker
      - run: sudo apt-get update -qq && sudo apt install curl gettext-base
      - run:
          working_directory: ~/opencti/internal-import-file/import-file-stix
          name: Build Docker image opencti/connector-import-file-stix
          command: docker build -t opencti/connector-import-file-stix:latest . && docker tag opencti/connector-import-file-stix:latest opencti/connector-import-file-stix:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-import-file/import-document
          name: Build Docker image opencti/connector-import-document
          command: docker build -t opencti/connector-import-document:latest . && docker tag opencti/connector-import-document:latest opencti/connector-import-document:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-export-file/export-file-stix
          name: Build Docker image opencti/connector-export-file-stix
          command: docker build -t opencti/connector-export-file-stix:latest . && docker tag opencti/connector-export-file-stix:latest opencti/connector-export-file-stix:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-export-file/export-file-txt
          name: Build Docker image opencti/connector-export-file-txt
          command: docker build -t opencti/connector-export-file-txt:latest . && docker tag opencti/connector-export-file-txt:latest opencti/connector-export-file-txt:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/hygiene
          name: Build Docker image opencti/connector-hygiene
          command: docker build -t opencti/connector-hygiene:latest . && docker tag opencti/connector-hygiene:latest opencti/connector-hygiene:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/alienvault
          name: Build Docker image opencti/connector-alienvault
          command: docker build -t opencti/connector-alienvault:latest . && docker tag opencti/connector-alienvault:latest opencti/connector-alienvault:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/diode-import
          name: Build Docker image opencti/connector-diode-import
          command: docker build -t opencti/connector-diode-import:latest . && docker tag opencti/connector-diode-import:latest opencti/connector-diode-import:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/crowdstrike
          name: Build Docker image opencti/connector-crowdstrike
          command: docker build -t opencti/connector-crowdstrike:latest . && docker tag opencti/connector-crowdstrike:latest opencti/connector-crowdstrike:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/cuckoo
          name: Build Docker image opencti/connector-cuckoo
          command: docker build -t opencti/connector-cuckoo:latest . && docker tag opencti/connector-cuckoo:latest opencti/connector-cuckoo:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-export-file/export-file-csv
          name: Build Docker image opencti/connector-export-file-csv
          command: docker build -t opencti/connector-export-file-csv:latest . && docker tag opencti/connector-export-file-csv:latest opencti/connector-export-file-csv:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/cape
          name: Build Docker image opencti/connector-cape
          command: docker build -t opencti/connector-cape:latest . && docker tag opencti/connector-cape:latest opencti/connector-cape:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/domaintools
          name: Build Docker image opencti/connector-domaintools
          command: docker build -t opencti/connector-domaintools:latest . && docker tag opencti/connector-domaintools:latest opencti/connector-domaintools:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/misp
          name: Build Docker image opencti/connector-misp
          command: docker build -t opencti/connector-misp:latest . && docker tag opencti/connector-misp:latest opencti/connector-misp:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/mitre
          name: Build Docker image opencti/connector-mitre
          command: docker build -t opencti/connector-mitre:latest . && docker tag opencti/connector-mitre:latest opencti/connector-mitre:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/opencti
          name: Build Docker image opencti/connector-opencti
          command: docker build -t opencti/connector-opencti:latest . && docker tag opencti/connector-opencti:latest opencti/connector-opencti:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/cve
          name: Build Docker image opencti/connector-cve
          command: docker build -t opencti/connector-cve:latest . && docker tag opencti/connector-cve:latest opencti/connector-cve:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/sentinelone-threats
          name: Build Docker image opencti/connector-sentinelone-threats
          command: docker build -t opencti/connector-sentinelone-threats:latest . && docker tag opencti/connector-sentinelone-threats:latest opencti/connector-sentinelone-threats:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/ipinfo
          name: Build Docker image opencti/connector-ipinfo
          command: docker build -t opencti/connector-ipinfo:latest . && docker tag opencti/connector-ipinfo:latest opencti/connector-ipinfo:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/virustotal
          name: Build Docker image opencti/connector-virustotal
          command: docker build -t opencti/connector-virustotal:latest . && docker tag opencti/connector-virustotal:latest opencti/connector-virustotal:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/virustotal-downloader
          name: Build Docker image opencti/connector-virustotal-downloader
          command: docker build -t opencti/connector-virustotal-downloader:latest . && docker tag opencti/connector-virustotal-downloader:latest opencti/connector-virustotal-downloader:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/lastinfosec
          name: Build Docker image opencti/connector-lastinfosec
          command: docker build -t opencti/connector-lastinfosec:latest . && docker tag opencti/connector-lastinfosec:latest opencti/connector-lastinfosec:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/malpedia
          name: Build Docker image opencti/connector-malpedia
          command: docker build -t opencti/connector-malpedia:latest . && docker tag opencti/connector-malpedia:latest opencti/connector-malpedia:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/mwdb
          name: Build Docker image opencti/connector-mwdb
          command: docker build -t opencti/connector-mwdb:latest . && docker tag opencti/connector-mwdb:latest opencti/connector-mwdb:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/riskiq
          name: Build Docker image opencti/connector-riskiq
          command: docker build -t opencti/connector-riskiq:latest . && docker tag opencti/connector-riskiq:latest opencti/connector-riskiq:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/valhalla
          name: Build Docker image opencti/connector-valhalla
          command: docker build -t opencti/connector-valhalla:latest . && docker tag opencti/connector-valhalla:latest opencti/connector-valhalla:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/stream/tanium
          name: Build Docker image opencti/connector-tanium
          command: docker build -t opencti/connector-tanium:latest . && docker tag opencti/connector-tanium:latest opencti/connector-tanium:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/mandiant
          name: Build Docker image opencti/connector-mandiant
          command: docker build -t opencti/connector-mandiant:latest . && docker tag opencti/connector-mandiant:latest opencti/connector-mandiant:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/kaspersky
          name: Build Docker image opencti/connector-kaspersky
          command: docker build -t opencti/connector-kaspersky:latest . && docker tag opencti/connector-kaspersky:latest opencti/connector-kaspersky:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/greynoise
          name: Build Docker image opencti/connector-greynoise
          command: docker build -t opencti/connector-greynoise:latest . && docker tag opencti/connector-greynoise:latest opencti/connector-greynoise:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/taxii2
          name: Build Docker image opencti/connector-taxii2
          command: docker build -t opencti/connector-taxii2:latest . && docker tag opencti/connector-taxii2:latest opencti/connector-taxii2:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/thehive
          name: Build Docker image opencti/connector-thehive
          command: docker build -t opencti/connector-thehive:latest . && docker tag opencti/connector-thehive:latest opencti/connector-thehive:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/abuseipdb
          name: Build Docker image opencti/connector-abuseipdb
          command: docker build -t opencti/connector-abuseipdb:latest . && docker tag opencti/connector-abuseipdb:latest opencti/connector-abuseipdb:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/urlhaus
          name: Build Docker image opencti/connector-urlhaus
          command: docker build -t opencti/connector-urlhaus:latest . && docker tag opencti/connector-urlhaus:latest opencti/connector-urlhaus:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/malbeacon
          name: Build Docker image opencti/connector-malbeacon
          command: docker build -t opencti/connector-malbeacon:latest . && docker tag opencti/connector-malbeacon:latest opencti/connector-malbeacon:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/crowdsec
          name: Build Docker image opencti/connector-crowdsec
          command: docker build -t opencti/connector-crowdsec:latest . && docker tag opencti/connector-crowdsec:latest opencti/connector-crowdsec:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/sophoslabs-intelix
          name: Build Docker image opencti/connector-sophoslabs-intelix
          command: docker build -t opencti/connector-sophoslabs-intelix:latest . && docker tag opencti/connector-sophoslabs-intelix:latest opencti/connector-sophoslabs-intelix:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/flashpoint
          name: Build Docker image opencti/connector-flashpoint
          command: docker build -t opencti/connector-flashpoint:latest . && docker tag opencti/connector-flashpoint:latest opencti/connector-flashpoint:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/tagger
          name: Build Docker image opencti/connector-tagger
          command: docker build -t opencti/connector-tagger:latest . && docker tag opencti/connector-tagger:latest opencti/connector-tagger:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/eset
          name: Build Docker image opencti/connector-eset
          command: docker build -t opencti/connector-eset:latest . && docker tag opencti/connector-eset:latest opencti/connector-eset:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/silobreaker
          name: Build Docker image opencti/connector-silobreaker
          command: docker build -t opencti/connector-silobreaker:latest . && docker tag opencti/connector-silobreaker:latest opencti/connector-silobreaker:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/stream/sentinel
          name: Build Docker image opencti/connector-sentinel
          command: docker build -t opencti/connector-sentinel:latest . && docker tag opencti/connector-sentinel:latest opencti/connector-sentinel:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/cybersixgill
          name: Build Docker image opencti/connector-cybersixgill
          command: docker build -t opencti/connector-cybersixgill:latest . && docker tag opencti/connector-cybersixgill:latest opencti/connector-cybersixgill:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/tweetfeed
          name: Build Docker image opencti/connector-tweetfeed
          command: docker build -t opencti/connector-tweetfeed:latest . && docker tag opencti/connector-tweetfeed:latest opencti/connector-tweetfeed:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/threatfox
          name: Build Docker image opencti/connector-threatfox
          command: docker build -t opencti/connector-threatfox:latest . && docker tag opencti/connector-threatfox:latest opencti/connector-threatfox:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/vmray-analyzer
          name: Build Docker image opencti/connector-vmray-analyzer
          command: docker build -t opencti/connector-vmray-analyzer:latest . && docker tag opencti/connector-vmray-analyzer:latest opencti/connector-vmray-analyzer:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/stream/virustotal-livehunt-rules
          name: Build Docker image opencti/connector-virustotal-livehunt-rules
          command: docker build -t opencti/connector-virustotal-livehunt-rules:latest . && docker tag opencti/connector-virustotal-livehunt-rules:latest opencti/connector-virustotal-livehunt-rules:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/stream/taxii-post
          name: Build Docker image opencti/connector-taxii-post
          command: docker build -t opencti/connector-taxii-post:latest . && docker tag opencti/connector-taxii-post:latest opencti/connector-taxii-post:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/feedly
          name: Build Docker image opencti/connector-feedly
          command: docker build -t opencti/connector-feedly:latest . && docker tag opencti/connector-feedly:latest opencti/connector-feedly:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/stream/logrhythm
          name: Build Docker image opencti/connector-logrhythm
          command: docker build -t opencti/connector-logrhythm:latest . && docker tag opencti/connector-logrhythm:latest opencti/connector-logrhythm:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/orion-malware
          name: Build Docker image opencti/connector-orion-malware
          command: docker build -t opencti/connector-orion-malware:latest . && docker tag opencti/connector-orion-malware:latest opencti/connector-orion-malware:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/comlaude
          name: Build Docker image opencti/connector-comlaude
          command: docker build -t opencti/connector-comlaude:latest . && docker tag opencti/connector-comlaude:latest opencti/connector-comlaude:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/stream/harfanglab
          name: Build Docker image opencti/connector-harfanglab
          command: docker build -t opencti/connector-harfanglab:latest . && docker tag opencti/connector-harfanglab:latest opencti/connector-harfanglab:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/crtsh
          name: Build Docker image opencti/connector-crtsh
          command: docker build -t opencti/connector-crtsh:latest . && docker tag opencti/connector-crtsh:latest opencti/connector-crtsh:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/rst-report-hub
          name: Build Docker image opencti/connector-rst-report-hub
          command: docker build -t opencti/connector-rst-report-hub:latest . && docker tag opencti/connector-rst-report-hub:latest opencti/connector-rst-report-hub:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/rst-threat-feed
          name: Build Docker image opencti/connector-rst-threat-feed
          command: docker build -t opencti/connector-rst-threat-feed:latest . && docker tag opencti/connector-rst-threat-feed:latest opencti/connector-rst-threat-feed:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/hostio
          name: Build Docker image opencti/connector-hostio
          command: docker build -t opencti/connector-hostio:latest . && docker tag opencti/connector-hostio:latest opencti/connector-hostio:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/intelfinder
          name: Build Docker image opencti/connector-intelfinder
          command: docker build -t opencti/connector-intelfinder:latest . && docker tag opencti/connector-intelfinder:latest opencti/connector-intelfinder:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-export-file/export-ttps-file-navigator
          name: Build Docker image opencti/connector-export-ttps-file-navigator
          command: docker build -t opencti/connector-export-ttps-file-navigator:latest . && docker tag opencti/connector-export-ttps-file-navigator:latest opencti/connector-export-ttps-file-navigator:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/google-drive
          name: Build Docker image opencti/connector-google-drive
          command: docker build -t opencti/connector-google-drive:latest . && docker tag opencti/connector-google-drive:latest opencti/connector-google-drive:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/stream/crowdstrike-endpoint-security
          name: Build Docker image opencti/connector-crowdstrike-endpoint-security
          command: docker build -t opencti/connector-crowdstrike-endpoint-security:latest . && docker tag opencti/connector-crowdstrike-endpoint-security:latest opencti/connector-crowdstrike-endpoint-security:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/dnstwist
          name: Build Docker image opencti/connector-dnstwist
          command: docker build -t opencti/connector-dnstwist:latest . && docker tag opencti/connector-dnstwist:latest opencti/connector-dnstwist:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/cpe
          name: Build Docker image opencti/connector-cpe
          command: docker build -t opencti/connector-cpe:latest . && docker tag opencti/connector-cpe:latest opencti/connector-cpe:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/urlscan-enrichment
          name: Build Docker image opencti/connector-urlscan-enrichment
          command: docker build -t opencti/connector-urlscan-enrichment:latest . && docker tag opencti/connector-urlscan-enrichment:latest opencti/connector-urlscan-enrichment:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/mitre-atlas
          name: Build Docker image opencti/connector-mitre-atlas
          command: docker build -t opencti/connector-mitre-atlas:latest . && docker tag opencti/connector-mitre-atlas:latest opencti/connector-mitre-atlas:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/malcore
          name: Build Docker image opencti/connector-malcore
          command: docker build -t opencti/connector-malcore:latest . && docker tag opencti/connector-malcore:latest opencti/connector-malcore:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/infoblox
          name: Build Docker image opencti/connector-infoblox
          command: docker build -t opencti/connector-infoblox:latest . && docker tag opencti/connector-infoblox:latest opencti/connector-infoblox:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/cisco-sma
          name: Build Docker image opencti/connector-cisco-sma
          command: docker build -t opencti/connector-cisco-sma:latest . && docker tag opencti/connector-cisco-sma:latest opencti/connector-cisco-sma:${CIRCLE_TAG}
      - run:
          name: Publish Docker Image to Docker Hub
          command: |
            echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
            docker push opencti/connector-import-file-stix:latest
            docker push opencti/connector-import-file-stix:${CIRCLE_TAG}
            docker push opencti/connector-import-document:latest
            docker push opencti/connector-import-document:${CIRCLE_TAG}
            docker push opencti/connector-export-file-stix:latest
            docker push opencti/connector-export-file-stix:${CIRCLE_TAG}
            docker push opencti/connector-export-file-csv:latest
            docker push opencti/connector-export-file-csv:${CIRCLE_TAG}
            docker push opencti/connector-export-file-txt:latest
            docker push opencti/connector-export-file-txt:${CIRCLE_TAG}
            docker push opencti/connector-hygiene:latest
            docker push opencti/connector-hygiene:${CIRCLE_TAG}
            docker push opencti/connector-diode-import:latest
            docker push opencti/connector-diode-import:${CIRCLE_TAG}
            docker push opencti/connector-alienvault:latest
            docker push opencti/connector-alienvault:${CIRCLE_TAG}
            docker push opencti/connector-crowdstrike:latest
            docker push opencti/connector-crowdstrike:${CIRCLE_TAG}
            docker push opencti/connector-cuckoo:latest
            docker push opencti/connector-cuckoo:${CIRCLE_TAG}
            docker push opencti/connector-cape:latest
            docker push opencti/connector-cape:${CIRCLE_TAG}
            docker push opencti/connector-domaintools:latest
            docker push opencti/connector-domaintools:${CIRCLE_TAG}            
            docker push opencti/connector-misp:latest
            docker push opencti/connector-misp:${CIRCLE_TAG}
            docker push opencti/connector-mitre:latest
            docker push opencti/connector-mitre:${CIRCLE_TAG}
            docker push opencti/connector-opencti:latest
            docker push opencti/connector-opencti:${CIRCLE_TAG}
            docker push opencti/connector-cve:latest
            docker push opencti/connector-cve:${CIRCLE_TAG}
            docker push opencti/connector-sentinelone-threats:latest
            docker push opencti/connector-sentinelone-threats:${CIRCLE_TAG}
            docker push opencti/connector-ipinfo:latest
            docker push opencti/connector-ipinfo:${CIRCLE_TAG}
            docker push opencti/connector-virustotal:latest
            docker push opencti/connector-virustotal:${CIRCLE_TAG}
            docker push opencti/connector-virustotal-downloader:latest
            docker push opencti/connector-virustotal-downloader:${CIRCLE_TAG}
            docker push opencti/connector-lastinfosec:latest
            docker push opencti/connector-lastinfosec:${CIRCLE_TAG}
            docker push opencti/connector-malpedia:latest
            docker push opencti/connector-malpedia:${CIRCLE_TAG}
            docker push opencti/connector-mwdb:latest
            docker push opencti/connector-mwdb:${CIRCLE_TAG}
            docker push opencti/connector-riskiq:latest
            docker push opencti/connector-riskiq:${CIRCLE_TAG}
            docker push opencti/connector-valhalla:latest
            docker push opencti/connector-valhalla:${CIRCLE_TAG}
            docker push opencti/connector-tanium:latest
            docker push opencti/connector-tanium:${CIRCLE_TAG}
            docker push opencti/connector-mandiant:latest
            docker push opencti/connector-mandiant:${CIRCLE_TAG}
            docker push opencti/connector-kaspersky:latest
            docker push opencti/connector-kaspersky:${CIRCLE_TAG}
            docker push opencti/connector-greynoise:latest
            docker push opencti/connector-greynoise:${CIRCLE_TAG}
            docker push opencti/connector-taxii2:latest
            docker push opencti/connector-taxii2:${CIRCLE_TAG}
            docker push opencti/connector-thehive:latest
            docker push opencti/connector-thehive:${CIRCLE_TAG}
            docker push opencti/connector-abuseipdb:latest
            docker push opencti/connector-abuseipdb:${CIRCLE_TAG}
            docker push opencti/connector-urlhaus:latest
            docker push opencti/connector-urlhaus:${CIRCLE_TAG}
            docker push opencti/connector-malbeacon:latest
            docker push opencti/connector-malbeacon:${CIRCLE_TAG}
            docker push opencti/connector-crowdsec:latest
            docker push opencti/connector-crowdsec:${CIRCLE_TAG}
            docker push opencti/connector-sophoslabs-intelix:latest
            docker push opencti/connector-sophoslabs-intelix:${CIRCLE_TAG}
            docker push opencti/connector-flashpoint:latest
            docker push opencti/connector-flashpoint:${CIRCLE_TAG}
            docker push opencti/connector-tagger:latest
            docker push opencti/connector-tagger:${CIRCLE_TAG}
            docker push opencti/connector-eset:latest
            docker push opencti/connector-eset:${CIRCLE_TAG}
            docker push opencti/connector-silobreaker:latest
            docker push opencti/connector-silobreaker:${CIRCLE_TAG}
            docker push opencti/connector-sentinel:latest
            docker push opencti/connector-sentinel:${CIRCLE_TAG}
            docker push opencti/connector-cybersixgill:latest
            docker push opencti/connector-cybersixgill:${CIRCLE_TAG}
            docker push opencti/connector-tweetfeed:latest
            docker push opencti/connector-tweetfeed:${CIRCLE_TAG}
            docker push opencti/connector-threatfox:latest
            docker push opencti/connector-threatfox:${CIRCLE_TAG}
            docker push opencti/connector-vmray-analyzer:latest
            docker push opencti/connector-vmray-analyzer:${CIRCLE_TAG}
            docker push opencti/connector-virustotal-livehunt-rules:latest
            docker push opencti/connector-virustotal-livehunt-rules:${CIRCLE_TAG}
            docker push opencti/connector-taxii-post:latest
            docker push opencti/connector-taxii-post:${CIRCLE_TAG}
            docker push opencti/connector-feedly:latest
            docker push opencti/connector-feedly:${CIRCLE_TAG}
            docker push opencti/connector-logrhythm:latest
            docker push opencti/connector-logrhythm:${CIRCLE_TAG}
            docker push opencti/connector-orion-malware:latest
            docker push opencti/connector-orion-malware:${CIRCLE_TAG}
            docker push opencti/connector-comlaude:latest
            docker push opencti/connector-comlaude:${CIRCLE_TAG}
            docker push opencti/connector-harfanglab:latest
            docker push opencti/connector-harfanglab:${CIRCLE_TAG}
            docker push opencti/connector-crtsh:latest
            docker push opencti/connector-crtsh:${CIRCLE_TAG}
            docker push opencti/connector-rst-report-hub:latest
            docker push opencti/connector-rst-report-hub:${CIRCLE_TAG}
            docker push opencti/connector-rst-threat-feed:latest
            docker push opencti/connector-rst-threat-feed:${CIRCLE_TAG}
            docker push opencti/connector-hostio:latest
            docker push opencti/connector-hostio:${CIRCLE_TAG}
            docker push opencti/connector-intelfinder:latest
            docker push opencti/connector-intelfinder:${CIRCLE_TAG}
            docker push opencti/connector-export-ttps-file-navigator:latest
            docker push opencti/connector-export-ttps-file-navigator:${CIRCLE_TAG}
            docker push opencti/connector-google-drive:latest
            docker push opencti/connector-google-drive:${CIRCLE_TAG}
            docker push opencti/connector-crowdstrike-endpoint-security:latest
            docker push opencti/connector-crowdstrike-endpoint-security:${CIRCLE_TAG}
            docker push opencti/connector-dnstwist:latest
            docker push opencti/connector-dnstwist:${CIRCLE_TAG}
            docker push opencti/connector-cpe:latest
            docker push opencti/connector-cpe:${CIRCLE_TAG}
            docker push opencti/connector-urlscan-enrichment:latest
            docker push opencti/connector-urlscan-enrichment:${CIRCLE_TAG}
            docker push opencti/connector-mitre-atlas:latest
            docker push opencti/connector-mitre-atlas:${CIRCLE_TAG}
            docker push opencti/connector-malcore:latest
            docker push opencti/connector-malcore:${CIRCLE_TAG}
            docker push opencti/connector-infoblox:latest
            docker push opencti/connector-infoblox:${CIRCLE_TAG}
            docker push opencti/connector-cisco-sma:latest
            docker push opencti/connector-cisco-sma:${CIRCLE_TAG}
      - slack/notify:
          event: fail
          template: basic_fail_1
      - ms-teams/report:
          only_on_fail: true
          webhook_url: $MS_TEAMS_WEBHOOK_URL
  build_2:
    working_directory: ~/opencti
    docker:
      - image: cimg/base:stable-20.04
    steps:
      - checkout
      - setup_remote_docker
      - run: sudo apt-get update -qq && sudo apt install curl gettext-base
      - run:
          working_directory: ~/opencti/external-import/sekoia
          name: Build Docker image opencti/connector-sekoia
          command: docker build -t opencti/connector-sekoia:latest . && docker tag opencti/connector-sekoia:latest opencti/connector-sekoia:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/hybrid-analysis-sandbox
          name: Build Docker image opencti/connector-hybrid-analysis-sandbox
          command: docker build -t opencti/connector-hybrid-analysis-sandbox:latest . && docker tag opencti/connector-hybrid-analysis-sandbox:latest opencti/connector-hybrid-analysis-sandbox:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/stream/splunk
          name: Build Docker image opencti/connector-splunk
          command: docker build -t opencti/connector-splunk:latest . && docker tag opencti/connector-splunk:latest opencti/connector-splunk:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/stream/elastic
          name: Build Docker image opencti/connector-elastic
          command: docker build -t opencti/connector-elastic:latest . && docker tag opencti/connector-elastic:latest opencti/connector-elastic:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/vxvault
          name: Build Docker image opencti/connector-vxvault
          command: docker build -t opencti/connector-vxvault:latest . && docker tag opencti/connector-vxvault:latest opencti/connector-vxvault:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/shodan
          name: Build Docker image opencti/connector-shodan
          command: docker build -t opencti/connector-shodan:latest . && docker tag opencti/connector-shodan:latest opencti/connector-shodan:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/shodan-internetdb
          name: Build Docker image opencti/connector-shodan-internetdb
          command: docker build -t opencti/connector-shodan-internetdb:latest . && docker tag opencti/connector-shodan-internetdb:latest opencti/connector-shodan-internetdb:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/import-external-reference
          name: Build Docker image opencti/connector-import-external-reference
          command: docker build -t opencti/connector-import-external-reference:latest . && docker tag opencti/connector-import-external-reference:latest opencti/connector-import-external-reference:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/stream/backup-files
          name: Build Docker image opencti/connector-backup-files
          command: docker build -t opencti/connector-backup-files:latest . && docker tag opencti/connector-backup-files:latest opencti/connector-backup-files:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/threatmatch
          name: Build Docker image opencti/connector-threatmatch
          command: docker build -t opencti/connector-threatmatch:latest . && docker tag opencti/connector-threatmatch:latest opencti/connector-threatmatch:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/restore-files
          name: Build Docker image opencti/connector-restore-files
          command: docker build -t opencti/connector-restore-files:latest . && docker tag opencti/connector-restore-files:latest opencti/connector-restore-files:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/virustotal-livehunt-notifications
          name: Build Docker image opencti/connector-virustotal-livehunt-notifications
          command: docker build -t opencti/connector-virustotal-livehunt-notifications:latest . && docker tag opencti/connector-virustotal-livehunt-notifications:latest opencti/connector-virustotal-livehunt-notifications:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/cape-sandbox
          name: Build Docker image opencti/connector-cape-sandbox
          command: docker build -t opencti/connector-cape-sandbox:latest . && docker tag opencti/connector-cape-sandbox:latest opencti/connector-cape-sandbox:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/intezer-sandbox
          name: Build Docker image opencti/connector-intezer-sandbox
          command: docker build -t opencti/connector-intezer-sandbox:latest . && docker tag opencti/connector-intezer-sandbox:latest opencti/connector-intezer-sandbox:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/hatching-triage-sandbox
          name: Build Docker image opencti/connector-hatching-triage-sandbox
          command: docker build -t opencti/connector-hatching-triage-sandbox:latest . && docker tag opencti/connector-hatching-triage-sandbox:latest opencti/connector-hatching-triage-sandbox:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/unpac-me
          name: Build Docker image opencti/connector-unpac-me
          command: docker build -t opencti/connector-unpac-me:latest . && docker tag opencti/connector-unpac-me:latest opencti/connector-unpac-me:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/ivre
          name: Build Docker image opencti/connector-ivre
          command: docker build -t opencti/connector-ivre:latest . && docker tag opencti/connector-ivre:latest opencti/connector-ivre:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/malwarebazaar-recent-additions
          name: Build Docker image opencti/connector-malwarebazaar-recent-additions
          command: docker build -t opencti/connector-malwarebazaar-recent-additions:latest . && docker tag opencti/connector-malwarebazaar-recent-additions:latest opencti/connector-malwarebazaar-recent-additions:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/urlhaus-recent-payloads
          name: Build Docker image opencti/connector-urlhaus-recent-payloads
          command: docker build -t opencti/connector-urlhaus-recent-payloads:latest . && docker tag opencti/connector-urlhaus-recent-payloads:latest opencti/connector-urlhaus-recent-payloads:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-export-file/export-report-pdf
          name: Build Docker image opencti/connector-export-report-pdf
          command: docker build -t opencti/connector-export-report-pdf:latest . && docker tag opencti/connector-export-report-pdf:latest opencti/connector-export-report-pdf:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/obstracts
          name: Build Docker image opencti/connector-obstracts
          command: docker build -t opencti/connector-obstracts:latest . && docker tag opencti/connector-obstracts:latest opencti/connector-obstracts:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/stixify
          name: Build Docker image opencti/connector-stixify
          command: docker build -t opencti/connector-stixify:latest . && docker tag opencti/connector-stixify:latest opencti/connector-stixify:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/siemrules
          name: Build Docker image opencti/connector-siemrules
          command: docker build -t opencti/connector-siemrules:latest . && docker tag opencti/connector-siemrules:latest opencti/connector-siemrules:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/vulmatch
          name: Build Docker image opencti/connector-vulmatch
          command: docker build -t opencti/connector-vulmatch:latest . && docker tag opencti/connector-vulmatch:latest opencti/connector-vulmatch:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/cisa-known-exploited-vulnerabilities
          name: Build Docker image opencti/connector-cisa-known-exploited-vulnerabilities
          command: docker build -t opencti/connector-cisa-known-exploited-vulnerabilities:latest . && docker tag opencti/connector-cisa-known-exploited-vulnerabilities:latest opencti/connector-cisa-known-exploited-vulnerabilities:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/cyber-campaign-collection
          name: Build Docker image opencti/connector-cyber-campaign-collection
          command: docker build -t opencti/connector-cyber-campaign-collection:latest . && docker tag opencti/connector-cyber-campaign-collection:latest opencti/connector-cyber-campaign-collection:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/socprime
          name: Build Docker image opencti/connector-socprime
          command: docker build -t opencti/connector-socprime:latest . && docker tag opencti/connector-socprime:latest opencti/connector-socprime:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/urlscan
          name: Build Docker image opencti/connector-urlscan
          command: docker build -t opencti/connector-urlscan:latest . && docker tag opencti/connector-urlscan:latest opencti/connector-urlscan:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/maltiverse
          name: Build Docker image opencti/connector-maltiverse
          command: docker build -t opencti/connector-maltiverse:latest . && docker tag opencti/connector-maltiverse:latest opencti/connector-maltiverse:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/intel471
          name: Build Docker image opencti/connector-intel471
          command: docker build -t opencti/connector-intel471:latest . && docker tag opencti/connector-intel471:latest opencti/connector-intel471:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/orange-cyberdefense
          name: Build Docker image opencti/connector-orange-cyberdefense
          command: docker build -t opencti/connector-orange-cyberdefense:latest . && docker tag opencti/connector-orange-cyberdefense:latest opencti/connector-orange-cyberdefense:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/citalid
          name: Build Docker image opencti/connector-citalid
          command: docker build -t opencti/connector-citalid:latest . && docker tag opencti/connector-citalid:latest opencti/connector-citalid:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/abuseipdb-ipblacklist
          name: Build Docker image opencti/connector-abuseipdb-ipblacklist
          command: docker build -t opencti/connector-abuseipdb-ipblacklist:latest . && docker tag opencti/connector-abuseipdb-ipblacklist:latest opencti/connector-abuseipdb-ipblacklist:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/misp-feed
          name: Build Docker image opencti/connector-misp-feed
          command: docker build -t opencti/connector-misp-feed:latest . && docker tag opencti/connector-misp-feed:latest opencti/connector-misp-feed:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/disarm-framework
          name: Build Docker image opencti/connector-disarm-framework
          command: docker build -t opencti/connector-disarm-framework:latest . && docker tag opencti/connector-disarm-framework:latest opencti/connector-disarm-framework:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/chapsvision
          name: Build Docker image opencti/connector-chapsvision
          command: docker build -t opencti/connector-chapsvision:latest . && docker tag opencti/connector-chapsvision:latest opencti/connector-chapsvision:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/abuse-ssl
          name: Build Docker image opencti/connector-abuse-ssl
          command: docker build -t opencti/connector-abuse-ssl:latest . && docker tag opencti/connector-abuse-ssl:latest opencti/connector-abuse-ssl:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/ironnet
          name: Build Docker image opencti/connector-ironnet
          command: docker build -t opencti/connector-ironnet:latest . && docker tag opencti/connector-ironnet:latest opencti/connector-ironnet:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/recorded-future
          name: Build Docker image opencti/connector-recorded-future
          command: docker build -t opencti/connector-recorded-future:latest . && docker tag opencti/connector-recorded-future:latest opencti/connector-recorded-future:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/opencsam
          name: Build Docker image opencti/connector-opencsam
          command: docker build -t opencti/connector-opencsam:latest . && docker tag opencti/connector-opencsam:latest opencti/connector-opencsam:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/joe-sandbox
          name: Build Docker image opencti/connector-joe-sandbox
          command: docker build -t opencti/connector-joe-sandbox:latest . && docker tag opencti/connector-joe-sandbox:latest opencti/connector-joe-sandbox:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/crits
          name: Build Docker image opencti/connector-crits
          command: docker build -t opencti/connector-crits:latest . && docker tag opencti/connector-crits:latest opencti/connector-crits:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/yara
          name: Build Docker image opencti/connector-yara
          command: docker build -t opencti/connector-yara:latest . && docker tag opencti/connector-yara:latest opencti/connector-yara:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/ipqs
          name: Build Docker image opencti/connector-ipqs
          command: docker build -t opencti/connector-ipqs:latest . && docker tag opencti/connector-ipqs:latest opencti/connector-ipqs:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/google-dns
          name: Build Docker image opencti/connector-google-dns
          command: docker build -t opencti/connector-google-dns:latest . && docker tag opencti/connector-google-dns:latest opencti/connector-google-dns:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/stream/qradar
          name: Build Docker image opencti/connector-qradar
          command: docker build -t opencti/connector-qradar:latest . && docker tag opencti/connector-qradar:latest opencti/connector-qradar:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/stream/chronicle
          name: Build Docker image opencti/connector-chronicle
          command: docker build -t opencti/connector-chronicle:latest . && docker tag opencti/connector-chronicle:latest opencti/connector-chronicle:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/zerofox
          name: Build Docker image opencti/connector-zerofox
          command: docker build -t opencti/connector-zerofox:latest . && docker tag opencti/connector-zerofox:latest opencti/connector-zerofox:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/recordedfuture-enrichment
          name: Build Docker image opencti/connector-recordedfuture-enrichment
          command: docker build -t opencti/connector-recordedfuture-enrichment:latest . && docker tag opencti/connector-recordedfuture-enrichment:latest opencti/connector-recordedfuture-enrichment:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/lastinfosec
          name: Build Docker image opencti/connector-lastinfosec-enrichment
          command: docker build -t opencti/connector-lastinfosec-enrichment:latest . && docker tag opencti/connector-lastinfosec-enrichment:latest opencti/connector-lastinfosec-enrichment:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/stopforumspam
          name: Build Docker image opencti/connector-stopforumspam
          command: docker build -t opencti/connector-stopforumspam:latest . && docker tag opencti/connector-stopforumspam:latest opencti/connector-stopforumspam:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/phishunt
          name: Build Docker image opencti/connector-phishunt
          command: docker build -t opencti/connector-phishunt:latest . && docker tag opencti/connector-phishunt:latest opencti/connector-phishunt:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/attribution-tools
          name: Build Docker image opencti/connector-attribution-tools
          command: docker build -t opencti/connector-attribution-tools:latest . && docker tag opencti/connector-attribution-tools:latest opencti/connector-attribution-tools:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/cluster25
          name: Build Docker image opencti/connector-cluster25
          command: docker build -t opencti/connector-cluster25:latest . && docker tag opencti/connector-cluster25:latest opencti/connector-cluster25:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/ransomwarelive
          name: Build Docker image opencti/connector-ransomwarelive
          command: docker build -t opencti/connector-ransomwarelive:latest . && docker tag opencti/connector-ransomwarelive:latest opencti/connector-ransomwarelive:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/anyrun-feed
          name: Build Docker image opencti/connector-anyrun-feed
          command: docker build -t opencti/connector-anyrun-feed:latest . && docker tag opencti/connector-anyrun-feed:latest opencti/connector-anyrun-feed:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/anyrun-task
          name: Build Docker image opencti/connector-anyrun-task
          command: docker build -t opencti/connector-anyrun-task:latest . && docker tag opencti/connector-anyrun-task:latest opencti/connector-anyrun-task:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/greynoise-feed
          name: Build Docker image opencti/connector-greynoise-feed
          command: docker build -t opencti/connector-greynoise-feed:latest . && docker tag opencti/connector-greynoise-feed:latest opencti/connector-greynoise-feed:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/rst-noise-control
          name: Build Docker image opencti/connector-rst-noise-control
          command: docker build -t opencti/connector-rst-noise-control:latest . && docker tag opencti/connector-rst-noise-control:latest opencti/connector-rst-noise-control:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/red-flag-domains
          name: Build Docker image opencti/connector-red-flag-domains
          command: docker build -t opencti/connector-red-flag-domains:latest . && docker tag opencti/connector-red-flag-domains:latest opencti/connector-red-flag-domains:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/external-import/shadowserver
          name: Build Docker image opencti/connector-shadowserver
          command: docker build -t opencti/connector-shadowserver:latest . && docker tag opencti/connector-shadowserver:latest opencti/connector-shadowserver:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/internal-enrichment/reversinglabs-malware-presence
          name: Build Docker image opencti/connector-reversinglabs-malware-presence
          command: docker build -t opencti/connector-reversinglabs-malware-presence:latest . && docker tag opencti/connector-reversinglabs-malware-presence:latest opencti/connector-reversinglabs-malware-presence:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/stream/jira
          name: Build Docker image opencti/connector-jira
          command: docker build -t opencti/connector-jira:latest . && docker tag opencti/connector-jira:latest opencti/connector-jira:${CIRCLE_TAG}
      - run:
          working_directory: ~/opencti/stream/webhook
          name: Build Docker image opencti/connector-webhook
          command: docker build -t opencti/connector-webhook:latest . && docker tag opencti/connector-webhook:latest opencti/connector-webhook:${CIRCLE_TAG}
      - run:
          name: Publish Docker Image to Docker Hub
          command: |
            echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
            docker push opencti/connector-sekoia:latest
            docker push opencti/connector-sekoia:${CIRCLE_TAG}
            docker push opencti/connector-hybrid-analysis-sandbox:latest
            docker push opencti/connector-hybrid-analysis-sandbox:${CIRCLE_TAG}
            docker push opencti/connector-splunk:latest
            docker push opencti/connector-splunk:${CIRCLE_TAG}
            docker push opencti/connector-elastic:latest
            docker push opencti/connector-elastic:${CIRCLE_TAG}
            docker push opencti/connector-vxvault:latest
            docker push opencti/connector-vxvault:${CIRCLE_TAG}
            docker push opencti/connector-shodan:latest
            docker push opencti/connector-shodan:${CIRCLE_TAG}
            docker push opencti/connector-shodan-internetdb:latest
            docker push opencti/connector-shodan-internetdb:${CIRCLE_TAG}
            docker push opencti/connector-import-external-reference:latest
            docker push opencti/connector-import-external-reference:${CIRCLE_TAG}
            docker push opencti/connector-backup-files:latest
            docker push opencti/connector-backup-files:${CIRCLE_TAG}
            docker push opencti/connector-threatmatch:latest
            docker push opencti/connector-threatmatch:${CIRCLE_TAG}
            docker push opencti/connector-restore-files:latest
            docker push opencti/connector-restore-files:${CIRCLE_TAG}
            docker push opencti/connector-virustotal-livehunt-notifications:latest
            docker push opencti/connector-virustotal-livehunt-notifications:${CIRCLE_TAG}
            docker push opencti/connector-cape-sandbox:latest
            docker push opencti/connector-cape-sandbox:${CIRCLE_TAG}
            docker push opencti/connector-intezer-sandbox:latest
            docker push opencti/connector-intezer-sandbox:${CIRCLE_TAG}
            docker push opencti/connector-hatching-triage-sandbox:latest
            docker push opencti/connector-hatching-triage-sandbox:${CIRCLE_TAG}
            docker push opencti/connector-unpac-me:latest
            docker push opencti/connector-unpac-me:${CIRCLE_TAG}
            docker push opencti/connector-ivre:latest
            docker push opencti/connector-ivre:${CIRCLE_TAG}
            docker push opencti/connector-malwarebazaar-recent-additions:latest
            docker push opencti/connector-malwarebazaar-recent-additions:${CIRCLE_TAG}
            docker push opencti/connector-urlhaus-recent-payloads:latest
            docker push opencti/connector-urlhaus-recent-payloads:${CIRCLE_TAG}
            docker push opencti/connector-export-report-pdf:latest
            docker push opencti/connector-export-report-pdf:${CIRCLE_TAG}
            docker push opencti/connector-obstracts:latest
            docker push opencti/connector-obstracts:${CIRCLE_TAG}
            docker push opencti/connector-stixify:latest
            docker push opencti/connector-stixify:${CIRCLE_TAG}
            docker push opencti/connector-siemrules:latest
            docker push opencti/connector-siemrules:${CIRCLE_TAG}
            docker push opencti/connector-vulmatch:latest
            docker push opencti/connector-vulmatch:${CIRCLE_TAG}
            docker push opencti/connector-cisa-known-exploited-vulnerabilities:latest
            docker push opencti/connector-cisa-known-exploited-vulnerabilities:${CIRCLE_TAG}
            docker push opencti/connector-cyber-campaign-collection:latest
            docker push opencti/connector-cyber-campaign-collection:${CIRCLE_TAG}
            docker push opencti/connector-socprime:latest
            docker push opencti/connector-socprime:${CIRCLE_TAG}
            docker push opencti/connector-urlscan:latest
            docker push opencti/connector-urlscan:${CIRCLE_TAG}
            docker push opencti/connector-maltiverse:latest
            docker push opencti/connector-maltiverse:${CIRCLE_TAG}
            docker push opencti/connector-intel471:latest
            docker push opencti/connector-intel471:${CIRCLE_TAG}
            docker push opencti/connector-orange-cyberdefense:latest
            docker push opencti/connector-orange-cyberdefense:${CIRCLE_TAG}
            docker push opencti/connector-citalid:latest
            docker push opencti/connector-citalid:${CIRCLE_TAG}
            docker push opencti/connector-abuseipdb-ipblacklist:latest
            docker push opencti/connector-abuseipdb-ipblacklist:${CIRCLE_TAG}
            docker push opencti/connector-misp-feed:latest
            docker push opencti/connector-misp-feed:${CIRCLE_TAG}
            docker push opencti/connector-disarm-framework:latest
            docker push opencti/connector-disarm-framework:${CIRCLE_TAG}
            docker push opencti/connector-chapsvision:latest
            docker push opencti/connector-chapsvision:${CIRCLE_TAG}
            docker push opencti/connector-abuse-ssl:latest
            docker push opencti/connector-abuse-ssl:${CIRCLE_TAG}
            docker push opencti/connector-ironnet:latest
            docker push opencti/connector-ironnet:${CIRCLE_TAG}
            docker push opencti/connector-recorded-future:latest
            docker push opencti/connector-recorded-future:${CIRCLE_TAG}
            docker push opencti/connector-opencsam:latest
            docker push opencti/connector-opencsam:${CIRCLE_TAG}
            docker push opencti/connector-joe-sandbox:latest
            docker push opencti/connector-joe-sandbox:${CIRCLE_TAG}
            docker push opencti/connector-crits:latest
            docker push opencti/connector-crits:${CIRCLE_TAG}
            docker push opencti/connector-yara:latest
            docker push opencti/connector-yara:${CIRCLE_TAG}
            docker push opencti/connector-ipqs:latest
            docker push opencti/connector-ipqs:${CIRCLE_TAG}
            docker push opencti/connector-google-dns:latest
            docker push opencti/connector-google-dns:${CIRCLE_TAG}
            docker push opencti/connector-qradar:latest
            docker push opencti/connector-qradar:${CIRCLE_TAG}
            docker push opencti/connector-chronicle:latest
            docker push opencti/connector-chronicle:${CIRCLE_TAG}
            docker push opencti/connector-zerofox:latest
            docker push opencti/connector-zerofox:${CIRCLE_TAG}
            docker push opencti/connector-recordedfuture-enrichment:latest
            docker push opencti/connector-recordedfuture-enrichment:${CIRCLE_TAG}
            docker push opencti/connector-lastinfosec-enrichment:latest
            docker push opencti/connector-lastinfosec-enrichment:${CIRCLE_TAG}
            docker push opencti/connector-stopforumspam:latest
            docker push opencti/connector-stopforumspam:${CIRCLE_TAG}
            docker push opencti/connector-phishunt:latest
            docker push opencti/connector-phishunt:${CIRCLE_TAG}
            docker push opencti/connector-attribution-tools:latest
            docker push opencti/connector-attribution-tools:${CIRCLE_TAG}
            docker push opencti/connector-cluster25:latest
            docker push opencti/connector-cluster25:${CIRCLE_TAG}
            docker push opencti/connector-ransomwarelive:latest
            docker push opencti/connector-ransomwarelive:${CIRCLE_TAG}
            docker push opencti/connector-anyrun-feed:latest
            docker push opencti/connector-anyrun-feed:${CIRCLE_TAG}
            docker push opencti/connector-anyrun-task:latest
            docker push opencti/connector-anyrun-task:${CIRCLE_TAG}
            docker push opencti/connector-greynoise-feed:latest
            docker push opencti/connector-greynoise-feed:${CIRCLE_TAG}
            docker push opencti/connector-rst-noise-control:latest
            docker push opencti/connector-rst-noise-control:${CIRCLE_TAG}
            docker push opencti/connector-red-flag-domains:latest
            docker push opencti/connector-red-flag-domains:${CIRCLE_TAG}
            docker push opencti/connector-shadowserver:latest
            docker push opencti/connector-shadowserver:${CIRCLE_TAG}
            docker push opencti/connector-reversinglabs-malware-presence:latest
            docker push opencti/connector-reversinglabs-malware-presence:${CIRCLE_TAG}
            docker push opencti/connector-jira:latest
            docker push opencti/connector-jira:${CIRCLE_TAG}
            docker push opencti/connector-webhook:latest
            docker push opencti/connector-webhook:${CIRCLE_TAG}
      - slack/notify:
          event: fail
          template: basic_fail_1
      - ms-teams/report:
          only_on_fail: true
          webhook_url: $MS_TEAMS_WEBHOOK_URL
  build_fips_1:
    working_directory: ~/opencti
    docker:
      - image: cimg/base:stable-20.04
    steps:
      - checkout
      - setup_remote_docker
      - run: sudo apt-get update -qq && sudo apt install curl gettext-base
      - run:
          working_directory: ~/opencti/internal-import-file/import-file-stix
          name: Build Docker image opencti/connector-import-file-stix
          command: docker build -f Dockerfile_fips -t opencti/connector-import-file-stix:latest-fips . && docker tag opencti/connector-import-file-stix:latest-fips opencti/connector-import-file-stix:${CIRCLE_TAG}-fips
      - run:
          working_directory: ~/opencti/internal-import-file/import-document
          name: Build Docker image opencti/connector-import-document
          command: docker build -f Dockerfile_fips -t opencti/connector-import-document:latest-fips . && docker tag opencti/connector-import-document:latest-fips opencti/connector-import-document:${CIRCLE_TAG}-fips
      - run:
          working_directory: ~/opencti/internal-export-file/export-file-stix
          name: Build Docker image opencti/connector-export-file-stix
          command: docker build -f Dockerfile_fips -t opencti/connector-export-file-stix:latest-fips . && docker tag opencti/connector-export-file-stix:latest-fips opencti/connector-export-file-stix:${CIRCLE_TAG}-fips
      - run:
          working_directory: ~/opencti/internal-export-file/export-file-csv
          name: Build Docker image opencti/connector-export-file-csv
          command: docker build -f Dockerfile_fips -t opencti/connector-export-file-csv:latest-fips . && docker tag opencti/connector-export-file-csv:latest-fips opencti/connector-export-file-csv:${CIRCLE_TAG}-fips
      - run:
          working_directory: ~/opencti/internal-export-file/export-file-txt
          name: Build Docker image opencti/connector-export-file-txt
          command: docker build -f Dockerfile_fips -t opencti/connector-export-file-txt:latest-fips . && docker tag opencti/connector-export-file-txt:latest-fips opencti/connector-export-file-txt:${CIRCLE_TAG}-fips
      - run:
          name: Publish Docker Image to Docker Hub
          command: |
            echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
            docker push opencti/connector-import-file-stix:latest-fips
            docker push opencti/connector-import-file-stix:${CIRCLE_TAG}-fips
            docker push opencti/connector-import-document:latest-fips
            docker push opencti/connector-import-document:${CIRCLE_TAG}-fips
            docker push opencti/connector-export-file-stix:latest-fips
            docker push opencti/connector-export-file-stix:${CIRCLE_TAG}-fips
            docker push opencti/connector-export-file-csv:latest-fips
            docker push opencti/connector-export-file-csv:${CIRCLE_TAG}-fips
            docker push opencti/connector-export-file-txt:latest-fips
            docker push opencti/connector-export-file-txt:${CIRCLE_TAG}-fips
      - slack/notify:
          event: fail
          template: basic_fail_1
      - ms-teams/report:
          only_on_fail: true
          webhook_url: $MS_TEAMS_WEBHOOK_URL
  build_rolling_1:
    working_directory: ~/opencti
    docker:
      - image: cimg/base:stable-20.04
    steps:
      - checkout
      - setup_remote_docker
      - run: sudo apt-get update -qq && sudo apt install curl gettext-base
      - run:
          working_directory: ~/opencti
          name: Replace pycti requirement of stable version with latest master branch code
          command: find . -name requirements.txt -exec sed 's|^pycti==.*$|pycti @ git+https://github.com/OpenCTI-Platform/client-python@master|' -i {} \;
      - run:
          working_directory: ~/opencti/internal-import-file/import-file-stix
          name: Build Docker image opencti/connector-import-file-stix
          command: docker build -t opencti/connector-import-file-stix:rolling .
      - run:
          working_directory: ~/opencti/internal-import-file/import-document
          name: Build Docker image opencti/connector-import-document
          command: docker build -t opencti/connector-import-document:rolling .
      - run:
          working_directory: ~/opencti/internal-export-file/export-file-stix
          name: Build Docker image opencti/connector-export-file-stix
          command: docker build -t opencti/connector-export-file-stix:rolling .
      - run:
          working_directory: ~/opencti/internal-export-file/export-file-txt
          name: Build Docker image opencti/connector-export-file-txt
          command: docker build -t opencti/connector-export-file-txt:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/hygiene
          name: Build Docker image opencti/connector-hygiene
          command: docker build -t opencti/connector-hygiene:rolling .
      - run:
          working_directory: ~/opencti/external-import/alienvault
          name: Build Docker image opencti/connector-alienvault
          command: docker build -t opencti/connector-alienvault:rolling .
      - run:
          working_directory: ~/opencti/external-import/diode-import
          name: Build Docker image opencti/connector-diode-import
          command: docker build -t opencti/connector-diode-import:rolling .
      - run:
          working_directory: ~/opencti/external-import/crowdstrike
          name: Build Docker image opencti/connector-crowdstrike
          command: docker build -t opencti/connector-crowdstrike:rolling .
      - run:
          working_directory: ~/opencti/external-import/cuckoo
          name: Build Docker image opencti/connector-cuckoo
          command: docker build -t opencti/connector-cuckoo:rolling .
      - run:
          working_directory: ~/opencti/internal-export-file/export-file-csv
          name: Build Docker image opencti/connector-export-file-csv
          command: docker build -t opencti/connector-export-file-csv:rolling .
      - run:
          working_directory: ~/opencti/external-import/cape
          name: Build Docker image opencti/connector-cape
          command: docker build -t opencti/connector-cape:rolling .
      - run:
          working_directory: ~/opencti/external-import/misp
          name: Build Docker image opencti/connector-misp
          command: docker build -t opencti/connector-misp:rolling .
      - run:
          working_directory: ~/opencti/external-import/mitre
          name: Build Docker image opencti/connector-mitre
          command: docker build -t opencti/connector-mitre:rolling .
      - run:
          working_directory: ~/opencti/external-import/opencti
          name: Build Docker image opencti/connector-opencti
          command: docker build -t opencti/connector-opencti:rolling .
      - run:
          working_directory: ~/opencti/external-import/cve
          name: Build Docker image opencti/connector-cve
          command: docker build -t opencti/connector-cve:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/ipinfo
          name: Build Docker image opencti/connector-ipinfo
          command: docker build -t opencti/connector-ipinfo:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/virustotal
          name: Build Docker image opencti/connector-virustotal
          command: docker build -t opencti/connector-virustotal:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/virustotal-downloader
          name: Build Docker image opencti/connector-virustotal-downloader
          command: docker build -t opencti/connector-virustotal-downloader:rolling .
      - run:
          working_directory: ~/opencti/external-import/lastinfosec
          name: Build Docker image opencti/connector-lastinfosec
          command: docker build -t opencti/connector-lastinfosec:rolling .
      - run:
          working_directory: ~/opencti/external-import/malpedia
          name: Build Docker image opencti/connector-malpedia
          command: docker build -t opencti/connector-malpedia:rolling .
      - run:
          working_directory: ~/opencti/external-import/mwdb
          name: Build Docker image opencti/connector-mwdb
          command: docker build -t opencti/connector-mwdb:rolling .
      - run:
          working_directory: ~/opencti/external-import/riskiq
          name: Build Docker image opencti/connector-riskiq
          command: docker build -t opencti/connector-riskiq:rolling .
      - run:
          working_directory: ~/opencti/external-import/valhalla
          name: Build Docker image opencti/connector-valhalla
          command: docker build -t opencti/connector-valhalla:rolling .
      - run:
          working_directory: ~/opencti/stream/tanium
          name: Build Docker image opencti/connector-tanium
          command: docker build -t opencti/connector-tanium:rolling .
      - run:
          working_directory: ~/opencti/external-import/mandiant
          name: Build Docker image opencti/connector-mandiant
          command: docker build -t opencti/connector-mandiant:rolling .
      - run:
          working_directory: ~/opencti/external-import/kaspersky
          name: Build Docker image opencti/connector-kaspersky
          command: docker build -t opencti/connector-kaspersky:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/greynoise
          name: Build Docker image opencti/connector-greynoise
          command: docker build -t opencti/connector-greynoise:rolling .
      - run:
          working_directory: ~/opencti/external-import/taxii2
          name: Build Docker image opencti/connector-taxii2
          command: docker build -t opencti/connector-taxii2:rolling .
      - run:
          working_directory: ~/opencti/external-import/thehive
          name: Build Docker image opencti/connector-thehive
          command: docker build -t opencti/connector-thehive:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/abuseipdb
          name: Build Docker image opencti/connector-abuseipdb
          command: docker build -t opencti/connector-abuseipdb:rolling .
      - run:
          working_directory: ~/opencti/external-import/urlhaus
          name: Build Docker image opencti/connector-urlhaus
          command: docker build -t opencti/connector-urlhaus:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/malbeacon
          name: Build Docker image opencti/connector-malbeacon
          command: docker build -t opencti/connector-malbeacon:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/crowdsec
          name: Build Docker image opencti/connector-crowdsec
          command: docker build -t opencti/connector-crowdsec:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/sophoslabs-intelix
          name: Build Docker image opencti/connector-sophoslabs-intelix
          command: docker build -t opencti/connector-sophoslabs-intelix:rolling .
      - run:
          working_directory: ~/opencti/external-import/flashpoint
          name: Build Docker image opencti/connector-flashpoint
          command: docker build -t opencti/connector-flashpoint:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/tagger
          name: Build Docker image opencti/connector-tagger
          command: docker build -t opencti/connector-tagger:rolling .
      - run:
          working_directory: ~/opencti/external-import/eset
          name: Build Docker image opencti/connector-eset
          command: docker build -t opencti/connector-eset:rolling .
      - run:
          working_directory: ~/opencti/external-import/silobreaker
          name: Build Docker image opencti/connector-silobreaker
          command: docker build -t opencti/connector-silobreaker:rolling .
      - run:
          working_directory: ~/opencti/stream/sentinel
          name: Build Docker image opencti/connector-sentinel
          command: docker build -t opencti/connector-sentinel:rolling .
      - run:
          working_directory: ~/opencti/external-import/cybersixgill
          name: Build Docker image opencti/connector-cybersixgill
          command: docker build -t opencti/connector-cybersixgill:rolling .
      - run:
          working_directory: ~/opencti/external-import/tweetfeed
          name: Build Docker image opencti/connector-tweetfeed
          command: docker build -t opencti/connector-tweetfeed:rolling .
      - run:
          working_directory: ~/opencti/external-import/threatfox
          name: Build Docker image opencti/connector-threatfox
          command: docker build -t opencti/connector-threatfox:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/vmray-analyzer
          name: Build Docker image opencti/connector-vmray-analyzer
          command: docker build -t opencti/connector-vmray-analyzer:rolling .
      - run:
          working_directory: ~/opencti/stream/virustotal-livehunt-rules
          name: Build Docker image opencti/connector-virustotal-livehunt-rules
          command: docker build -t opencti/connector-virustotal-livehunt-rules:rolling .
      - run:
          working_directory: ~/opencti/stream/taxii-post
          name: Build Docker image opencti/connector-taxii-post
          command: docker build -t opencti/connector-taxii-post:rolling .
      - run:
          working_directory: ~/opencti/external-import/feedly
          name: Build Docker image opencti/connector-feedly
          command: docker build -t opencti/connector-feedly:rolling .
      - run:
          working_directory: ~/opencti/stream/logrhythm
          name: Build Docker image opencti/connector-logrhythm
          command: docker build -t opencti/connector-logrhythm:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/orion-malware
          name: Build Docker image opencti/connector-orion-malware
          command: docker build -t opencti/connector-orion-malware:rolling .
      - run:
          working_directory: ~/opencti/external-import/comlaude
          name: Build Docker image opencti/connector-comlaude
          command: docker build -t opencti/connector-comlaude:rolling .
      - run:
          working_directory: ~/opencti/stream/harfanglab
          name: Build Docker image opencti/connector-harfanglab
          command: docker build -t opencti/connector-harfanglab:rolling .
      - run:
          working_directory: ~/opencti/external-import/crtsh
          name: Build Docker image opencti/connector-crtsh
          command: docker build -t opencti/connector-crtsh:rolling .
      - run:
          working_directory: ~/opencti/external-import/rst-report-hub
          name: Build Docker image opencti/connector-rst-report-hub
          command: docker build -t opencti/connector-rst-report-hub:rolling .
      - run:
          working_directory: ~/opencti/external-import/rst-threat-feed
          name: Build Docker image opencti/connector-rst-threat-feed
          command: docker build -t opencti/connector-rst-threat-feed:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/hostio
          name: Build Docker image opencti/connector-hostio
          command: docker build -t opencti/connector-hostio:rolling .
      - run:
          working_directory: ~/opencti/external-import/intelfinder
          name: Build Docker image opencti/connector-intelfinder
          command: docker build -t opencti/connector-intelfinder:rolling .
      - run:
          working_directory: ~/opencti/internal-export-file/export-ttps-file-navigator
          name: Build Docker image opencti/connector-export-ttps-file-navigator
          command: docker build -t opencti/connector-export-ttps-file-navigator:rolling .
      - run:
          working_directory: ~/opencti/external-import/google-drive
          name: Build Docker image opencti/connector-google-drive
          command: docker build -t opencti/connector-google-drive:rolling .
      - run:
          working_directory: ~/opencti/stream/crowdstrike-endpoint-security
          name: Build Docker image opencti/connector-crowdstrike-endpoint-security
          command: docker build -t opencti/connector-crowdstrike-endpoint-security:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/dnstwist
          name: Build Docker image opencti/connector-dnstwist
          command: docker build -t opencti/connector-dnstwist:rolling .
      - run:
          working_directory: ~/opencti/external-import/cpe
          name: Build Docker image opencti/connector-cpe
          command: docker build -t opencti/connector-cpe:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/urlscan-enrichment
          name: Build Docker image opencti/connector-urlscan-enrichment
          command: docker build -t opencti/connector-urlscan-enrichment:rolling .
      - run:
          working_directory: ~/opencti/external-import/mitre-atlas
          name: Build Docker image opencti/connector-mitre-atlas
          command: docker build -t opencti/connector-mitre-atlas:rolling .
      - run:
          working_directory: ~/opencti/external-import/malcore
          name: Build Docker image opencti/connector-malcore
          command: docker build -t opencti/connector-malcore:rolling .
      - run:
          working_directory: ~/opencti/external-import/infoblox
          name: Build Docker image opencti/connector-infoblox
          command: docker build -t opencti/connector-infoblox:rolling .
      - run:
          working_directory: ~/opencti/external-import/cisco-sma
          name: Build Docker image opencti/connector-cisco-sma
          command: docker build -t opencti/connector-cisco-sma:rolling .
      - run:
          name: Publish Docker Image to Docker Hub
          command: |
            echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
            docker push opencti/connector-import-file-stix:rolling
            docker push opencti/connector-import-document:rolling
            docker push opencti/connector-export-file-stix:rolling
            docker push opencti/connector-export-file-csv:rolling
            docker push opencti/connector-export-file-txt:rolling
            docker push opencti/connector-hygiene:rolling
            docker push opencti/connector-alienvault:rolling
            docker push opencti/connector-diode-import:rolling
            docker push opencti/connector-crowdstrike:rolling
            docker push opencti/connector-cuckoo:rolling
            docker push opencti/connector-cape:rolling
            docker push opencti/connector-misp:rolling
            docker push opencti/connector-mitre:rolling
            docker push opencti/connector-opencti:rolling
            docker push opencti/connector-cve:rolling
            docker push opencti/connector-ipinfo:rolling
            docker push opencti/connector-virustotal:rolling
            docker push opencti/connector-virustotal-downloader:rolling
            docker push opencti/connector-lastinfosec:rolling
            docker push opencti/connector-malpedia:rolling
            docker push opencti/connector-mwdb:rolling
            docker push opencti/connector-riskiq:rolling
            docker push opencti/connector-valhalla:rolling
            docker push opencti/connector-tanium:rolling
            docker push opencti/connector-mandiant:rolling
            docker push opencti/connector-kaspersky:rolling
            docker push opencti/connector-greynoise:rolling
            docker push opencti/connector-taxii2:rolling
            docker push opencti/connector-thehive:rolling
            docker push opencti/connector-abuseipdb:rolling
            docker push opencti/connector-urlhaus:rolling
            docker push opencti/connector-malbeacon:rolling
            docker push opencti/connector-crowdsec:rolling
            docker push opencti/connector-sophoslabs-intelix:rolling
            docker push opencti/connector-flashpoint:rolling
            docker push opencti/connector-tagger:rolling
            docker push opencti/connector-eset:rolling
            docker push opencti/connector-silobreaker:rolling
            docker push opencti/connector-sentinel:rolling
            docker push opencti/connector-cybersixgill:rolling
            docker push opencti/connector-tweetfeed:rolling
            docker push opencti/connector-threatfox:rolling
            docker push opencti/connector-vmray-analyzer:rolling
            docker push opencti/connector-virustotal-livehunt-rules:rolling
            docker push opencti/connector-taxii-post:rolling
            docker push opencti/connector-feedly:rolling
            docker push opencti/connector-logrhythm:rolling
            docker push opencti/connector-orion-malware:rolling
            docker push opencti/connector-comlaude:rolling
            docker push opencti/connector-harfanglab:rolling
            docker push opencti/connector-crtsh:rolling
            docker push opencti/connector-rst-report-hub:rolling
            docker push opencti/connector-rst-threat-feed:rolling
            docker push opencti/connector-hostio:rolling
            docker push opencti/connector-intelfinder:rolling
            docker push opencti/connector-export-ttps-file-navigator:rolling
            docker push opencti/connector-google-drive:rolling
            docker push opencti/connector-crowdstrike-endpoint-security:rolling
            docker push opencti/connector-dnstwist:rolling
            docker push opencti/connector-cpe:rolling
            docker push opencti/connector-urlscan-enrichment:rolling
            docker push opencti/connector-mitre-atlas:rolling
            docker push opencti/connector-malcore:rolling
            docker push opencti/connector-infoblox:rolling
            docker push opencti/connector-cisco-sma:rolling
      - slack/notify:
          event: fail
          template: basic_fail_1
      - ms-teams/report:
          only_on_fail: true
          webhook_url: $MS_TEAMS_WEBHOOK_URL
  build_rolling_2:
    working_directory: ~/opencti
    docker:
      - image: cimg/base:stable-20.04
    steps:
      - checkout
      - setup_remote_docker
      - run: sudo apt-get update -qq && sudo apt install curl gettext-base
      - run:
          working_directory: ~/opencti
          name: Replace pycti requirement of stable version with latest master branch code
          command: find . -name requirements.txt -exec sed 's|^pycti==.*$|pycti @ git+https://github.com/OpenCTI-Platform/client-python@master|' -i {} \;
      - run:
          working_directory: ~/opencti/external-import/sekoia
          name: Build Docker image opencti/connector-sekoia
          command: docker build -t opencti/connector-sekoia:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/hybrid-analysis-sandbox
          name: Build Docker image opencti/connector-hybrid-analysis-sandbox
          command: docker build -t opencti/connector-hybrid-analysis-sandbox:rolling .
      - run:
          working_directory: ~/opencti/stream/splunk
          name: Build Docker image opencti/connector-splunk
          command: docker build -t opencti/connector-splunk:rolling .
      - run:
          working_directory: ~/opencti/stream/elastic
          name: Build Docker image opencti/connector-elastic
          command: docker build -t opencti/connector-elastic:rolling .
      - run:
          working_directory: ~/opencti/external-import/vxvault
          name: Build Docker image opencti/connector-vxvault
          command: docker build -t opencti/connector-vxvault:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/shodan
          name: Build Docker image opencti/connector-shodan
          command: docker build -t opencti/connector-shodan:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/shodan-internetdb
          name: Build Docker image opencti/connector-shodan-internetdb
          command: docker build -t opencti/connector-shodan-internetdb:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/import-external-reference
          name: Build Docker image opencti/connector-import-external-reference
          command: docker build -t opencti/connector-import-external-reference:rolling .
      - run:
          working_directory: ~/opencti/stream/backup-files
          name: Build Docker image opencti/connector-backup-files
          command: docker build -t opencti/connector-backup-files:rolling .
      - run:
          working_directory: ~/opencti/external-import/threatmatch
          name: Build Docker image opencti/connector-threatmatch
          command: docker build -t opencti/connector-threatmatch:rolling .
      - run:
          working_directory: ~/opencti/external-import/restore-files
          name: Build Docker image opencti/connector-restore-files
          command: docker build -t opencti/connector-restore-files:rolling .
      - run:
          working_directory: ~/opencti/external-import/virustotal-livehunt-notifications
          name: Build Docker image opencti/connector-virustotal-livehunt-notifications
          command: docker build -t opencti/connector-virustotal-livehunt-notifications:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/cape-sandbox
          name: Build Docker image opencti/connector-cape-sandbox
          command: docker build -t opencti/connector-cape-sandbox:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/domaintools
          name: Build Docker image opencti/connector-domaintools
          command: docker build -t opencti/connector-domaintools:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/intezer-sandbox
          name: Build Docker image opencti/connector-intezer-sandbox
          command: docker build -t opencti/connector-intezer-sandbox:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/hatching-triage-sandbox
          name: Build Docker image opencti/connector-hatching-triage-sandbox
          command: docker build -t opencti/connector-hatching-triage-sandbox:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/unpac-me
          name: Build Docker image opencti/connector-unpac-me
          command: docker build -t opencti/connector-unpac-me:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/ivre
          name: Build Docker image opencti/connector-ivre
          command: docker build -t opencti/connector-ivre:rolling .
      - run:
          working_directory: ~/opencti/external-import/malwarebazaar-recent-additions
          name: Build Docker image opencti/connector-malwarebazaar-recent-additions
          command: docker build -t opencti/connector-malwarebazaar-recent-additions:rolling .
      - run:
          working_directory: ~/opencti/external-import/urlhaus-recent-payloads
          name: Build Docker image opencti/connector-urlhaus-recent-payloads
          command: docker build -t opencti/connector-urlhaus-recent-payloads:rolling .
      - run:
          working_directory: ~/opencti/internal-export-file/export-report-pdf
          name: Build Docker image opencti/connector-export-report-pdf
          command: docker build -t opencti/connector-export-report-pdf:rolling .
      - run:
          working_directory: ~/opencti/external-import/obstracts
          name: Build Docker image opencti/connector-obstracts
          command: docker build -t opencti/connector-obstracts:rolling .
      - run:
          working_directory: ~/opencti/external-import/stixify
          name: Build Docker image opencti/connector-stixify
          command: docker build -t opencti/connector-stixify:rolling .
      - run:
          working_directory: ~/opencti/external-import/vulmatch
          name: Build Docker image opencti/connector-vulmatch
          command: docker build -t opencti/connector-vulmatch:rolling .
      - run:
          working_directory: ~/opencti/external-import/siemrules
          name: Build Docker image opencti/connector-siemrules
          command: docker build -t opencti/connector-siemrules:rolling .
      - run:
          working_directory: ~/opencti/external-import/cisa-known-exploited-vulnerabilities
          name: Build Docker image opencti/connector-cisa-known-exploited-vulnerabilities
          command: docker build -t opencti/connector-cisa-known-exploited-vulnerabilities:rolling .
      - run:
          working_directory: ~/opencti/external-import/cyber-campaign-collection
          name: Build Docker image opencti/connector-cyber-campaign-collection
          command: docker build -t opencti/connector-cyber-campaign-collection:rolling .
      - run:
          working_directory: ~/opencti/external-import/socprime
          name: Build Docker image opencti/connector-socprime
          command: docker build -t opencti/connector-socprime:rolling .
      - run:
          working_directory: ~/opencti/external-import/urlscan
          name: Build Docker image opencti/connector-urlscan
          command: docker build -t opencti/connector-urlscan:rolling .
      - run:
          working_directory: ~/opencti/external-import/maltiverse
          name: Build Docker image opencti/connector-maltiverse
          command: docker build -t opencti/connector-maltiverse:rolling .
      - run:
          working_directory: ~/opencti/external-import/intel471
          name: Build Docker image opencti/connector-intel471
          command: docker build -t opencti/connector-intel471:rolling .
      - run:
          working_directory: ~/opencti/external-import/orange-cyberdefense
          name: Build Docker image opencti/connector-orange-cyberdefense
          command: docker build -t opencti/connector-orange-cyberdefense:rolling .
      - run:
          working_directory: ~/opencti/external-import/citalid
          name: Build Docker image opencti/connector-citalid
          command: docker build -t opencti/connector-citalid:rolling .
      - run:
          working_directory: ~/opencti/external-import/abuseipdb-ipblacklist
          name: Build Docker image opencti/connector-abuseipdb-ipblacklist
          command: docker build -t opencti/connector-abuseipdb-ipblacklist:rolling .
      - run:
          working_directory: ~/opencti/external-import/misp-feed
          name: Build Docker image opencti/connector-misp-feed
          command: docker build -t opencti/connector-misp-feed:rolling .
      - run:
          working_directory: ~/opencti/external-import/disarm-framework
          name: Build Docker image opencti/connector-disarm-framework
          command: docker build -t opencti/connector-disarm-framework:rolling .
      - run:
          working_directory: ~/opencti/external-import/chapsvision
          name: Build Docker image opencti/connector-chapsvision
          command: docker build -t opencti/connector-chapsvision:rolling .
      - run:
          working_directory: ~/opencti/external-import/abuse-ssl
          name: Build Docker image opencti/connector-abuse-ssl
          command: docker build -t opencti/connector-abuse-ssl:rolling .
      - run:
          working_directory: ~/opencti/external-import/ironnet
          name: Build Docker image opencti/connector-ironnet
          command: docker build -t opencti/connector-ironnet:rolling .
      - run:
          working_directory: ~/opencti/external-import/recorded-future
          name: Build Docker image opencti/connector-recorded-future
          command: docker build -t opencti/connector-recorded-future:rolling .
      - run:
          working_directory: ~/opencti/external-import/opencsam
          name: Build Docker image opencti/connector-opencsam
          command: docker build -t opencti/connector-opencsam:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/joe-sandbox
          name: Build Docker image opencti/connector-joe-sandbox
          command: docker build -t opencti/connector-joe-sandbox:rolling .
      - run:
          working_directory: ~/opencti/external-import/crits
          name: Build Docker image opencti/connector-crits
          command: docker build -t opencti/connector-crits:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/yara
          name: Build Docker image opencti/connector-yara
          command: docker build -t opencti/connector-yara:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/ipqs
          name: Build Docker image opencti/connector-ipqs
          command: docker build -t opencti/connector-ipqs:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/google-dns
          name: Build Docker image opencti/connector-google-dns
          command: docker build -t opencti/connector-google-dns:rolling .
      - run:
          working_directory: ~/opencti/stream/qradar
          name: Build Docker image opencti/connector-qradar
          command: docker build -t opencti/connector-qradar:rolling .
      - run:
          working_directory: ~/opencti/stream/chronicle
          name: Build Docker image opencti/connector-chronicle
          command: docker build -t opencti/connector-chronicle:rolling .
      - run:
          working_directory: ~/opencti/external-import/zerofox
          name: Build Docker image opencti/connector-zerofox
          command: docker build -t opencti/connector-zerofox:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/recordedfuture-enrichment
          name: Build Docker image opencti/connector-recordedfuture-enrichment
          command: docker build -t opencti/connector-recordedfuture-enrichment:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/lastinfosec
          name: Build Docker image opencti/connector-lastinfosec-enrichment
          command: docker build -t opencti/connector-lastinfosec-enrichment:rolling .
      - run:
          working_directory: ~/opencti/external-import/stopforumspam
          name: Build Docker image opencti/connector-stopforumspam
          command: docker build -t opencti/connector-stopforumspam:rolling .
      - run:
          working_directory: ~/opencti/external-import/phishunt
          name: Build Docker image opencti/connector-phishunt
          command: docker build -t opencti/connector-phishunt:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/attribution-tools
          name: Build Docker image opencti/connector-attribution-tools
          command: docker build -t opencti/connector-attribution-tools:rolling .
      - run:
          working_directory: ~/opencti/external-import/cluster25
          name: Build Docker image opencti/connector-cluster25
          command: docker build -t opencti/connector-cluster25:rolling .
      - run:
          working_directory: ~/opencti/external-import/ransomwarelive
          name: Build Docker image opencti/connector-ransomwarelive
          command: docker build -t opencti/connector-ransomwarelive:rolling .
      - run:
          working_directory: ~/opencti/external-import/anyrun-feed
          name: Build Docker image opencti/connector-anyrun-feed
          command: docker build -t opencti/connector-anyrun-feed:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/anyrun-task
          name: Build Docker image opencti/connector-anyrun-task
          command: docker build -t opencti/connector-anyrun-task:rolling .
      - run:
          working_directory: ~/opencti/external-import/greynoise-feed
          name: Build Docker image opencti/connector-greynoise-feed
          command: docker build -t opencti/connector-greynoise-feed:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/rst-noise-control
          name: Build Docker image opencti/connector-rst-noise-control
          command: docker build -t opencti/connector-rst-noise-control:rolling .
      - run:
          working_directory: ~/opencti/external-import/red-flag-domains
          name: Build Docker image opencti/connector-red-flag-domains
          command: docker build -t opencti/connector-red-flag-domains:rolling .
      - run:
          working_directory: ~/opencti/external-import/shadowserver
          name: Build Docker image opencti/connector-shadowserver
          command: docker build -t opencti/connector-shadowserver:rolling .
      - run:
          working_directory: ~/opencti/internal-enrichment/reversinglabs-malware-presence
          name: Build Docker image opencti/connector-reversinglabs-malware-presence
          command: docker build -t opencti/connector-reversinglabs-malware-presence:rolling .
      - run:
          working_directory: ~/opencti/stream/jira
          name: Build Docker image opencti/connector-jira
          command: docker build -t opencti/connector-jira:rolling .
      - run:
          working_directory: ~/opencti/stream/webhook
          name: Build Docker image opencti/connector-webhook
          command: docker build -t opencti/connector-webhook:rolling .
      - run:
          name: Publish Docker Image to Docker Hub
          command: |
            echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
            docker push opencti/connector-sekoia:rolling
            docker push opencti/connector-hybrid-analysis-sandbox:rolling
            docker push opencti/connector-splunk:rolling
            docker push opencti/connector-elastic:rolling
            docker push opencti/connector-vxvault:rolling
            docker push opencti/connector-shodan:rolling
            docker push opencti/connector-shodan-internetdb:rolling
            docker push opencti/connector-import-external-reference:rolling
            docker push opencti/connector-backup-files:rolling
            docker push opencti/connector-threatmatch:rolling
            docker push opencti/connector-restore-files:rolling
            docker push opencti/connector-virustotal-livehunt-notifications:rolling
            docker push opencti/connector-cape-sandbox:rolling
            docker push opencti/connector-domaintools:rolling
            docker push opencti/connector-intezer-sandbox:rolling
            docker push opencti/connector-hatching-triage-sandbox:rolling
            docker push opencti/connector-unpac-me:rolling
            docker push opencti/connector-ivre:rolling
            docker push opencti/connector-malwarebazaar-recent-additions:rolling
            docker push opencti/connector-urlhaus-recent-payloads:rolling
            docker push opencti/connector-export-report-pdf:rolling
            docker push opencti/connector-obstracts:rolling
            docker push opencti/connector-stixify:rolling
            docker push opencti/connector-vulmatch:rolling
            docker push opencti/connector-siemrules:rolling
            docker push opencti/connector-cisa-known-exploited-vulnerabilities:rolling
            docker push opencti/connector-cyber-campaign-collection:rolling
            docker push opencti/connector-socprime:rolling
            docker push opencti/connector-urlscan:rolling
            docker push opencti/connector-maltiverse:rolling
            docker push opencti/connector-intel471:rolling
            docker push opencti/connector-orange-cyberdefense:rolling
            docker push opencti/connector-citalid:rolling
            docker push opencti/connector-abuseipdb-ipblacklist:rolling
            docker push opencti/connector-misp-feed:rolling
            docker push opencti/connector-disarm-framework:rolling
            docker push opencti/connector-chapsvision:rolling
            docker push opencti/connector-abuse-ssl:rolling
            docker push opencti/connector-ironnet:rolling
            docker push opencti/connector-recorded-future:rolling
            docker push opencti/connector-opencsam:rolling
            docker push opencti/connector-joe-sandbox:rolling
            docker push opencti/connector-crits:rolling
            docker push opencti/connector-yara:rolling
            docker push opencti/connector-ipqs:rolling
            docker push opencti/connector-google-dns:rolling
            docker push opencti/connector-qradar:rolling
            docker push opencti/connector-chronicle:rolling
            docker push opencti/connector-zerofox:rolling
            docker push opencti/connector-recordedfuture-enrichment:rolling
            docker push opencti/connector-lastinfosec-enrichment:rolling
            docker push opencti/connector-stopforumspam:rolling
            docker push opencti/connector-phishunt:rolling
            docker push opencti/connector-attribution-tools:rolling
            docker push opencti/connector-cluster25:rolling
            docker push opencti/connector-ransomwarelive:rolling
            docker push opencti/connector-anyrun-feed:rolling
            docker push opencti/connector-anyrun-task:rolling
            docker push opencti/connector-greynoise-feed:rolling
            docker push opencti/connector-rst-noise-control:rolling
            docker push opencti/connector-red-flag-domains:rolling
            docker push opencti/connector-shadowserver:rolling
            docker push opencti/connector-reversinglabs-malware-presence:rolling
            docker push opencti/connector-jira:rolling
            docker push opencti/connector-webhook:rolling
      - slack/notify:
          event: fail
          template: basic_fail_1
      - ms-teams/report:
          only_on_fail: true
          webhook_url: $MS_TEAMS_WEBHOOK_URL
  build_fips_rolling_1:
    working_directory: ~/opencti
    docker:
      - image: cimg/base:stable-20.04
    steps:
      - checkout
      - setup_remote_docker
      - run: sudo apt-get update -qq && sudo apt install curl gettext-base
      - run:
          working_directory: ~/opencti
          name: Replace pycti requirement of stable version with latest master branch code
          command: find . -name requirements.txt -exec sed 's|^pycti==.*$|pycti @ git+https://github.com/OpenCTI-Platform/client-python@master|' -i {} \;
      - run:
          working_directory: ~/opencti/internal-import-file/import-file-stix
          name: Build Docker image opencti/connector-import-file-stix
          command: docker build -f Dockerfile_fips -t opencti/connector-import-file-stix:rolling-fips .
      - run:
          working_directory: ~/opencti/internal-import-file/import-document
          name: Build Docker image opencti/connector-import-document
          command: docker build -f Dockerfile_fips -t opencti/connector-import-document:rolling-fips .
      - run:
          working_directory: ~/opencti/internal-export-file/export-file-stix
          name: Build Docker image opencti/connector-export-file-stix
          command: docker build -f Dockerfile_fips -t opencti/connector-export-file-stix:rolling-fips .
      - run:
          working_directory: ~/opencti/internal-export-file/export-file-csv
          name: Build Docker image opencti/connector-export-file-csv
          command: docker build -f Dockerfile_fips -t opencti/connector-export-file-csv:rolling-fips .
      - run:
          working_directory: ~/opencti/internal-export-file/export-file-txt
          name: Build Docker image opencti/connector-export-file-txt
          command: docker build -f Dockerfile_fips -t opencti/connector-export-file-txt:rolling-fips .
      - run:
          name: Publish Docker Image to Docker Hub
          command: |
            echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
            docker push opencti/connector-import-file-stix:rolling-fips
            docker push opencti/connector-import-document:rolling-fips
            docker push opencti/connector-export-file-stix:rolling-fips
            docker push opencti/connector-export-file-csv:rolling-fips
            docker push opencti/connector-export-file-txt:rolling-fips
      - slack/notify:
          event: fail
          template: basic_fail_1
      - ms-teams/report:
          only_on_fail: true
          webhook_url: $MS_TEAMS_WEBHOOK_URL
  notify_rolling:
    docker:
      - image: "cimg/base:stable"
    steps:
      - run: sudo apt-get update -qq && sudo apt install curl gettext-base
      - slack/notify:
          event: pass
          template: basic_success_1
      - ms-teams/report:
          only_on_fail: false
          webhook_url: $MS_TEAMS_WEBHOOK_URL
  notify:
    docker:
      - image: "cimg/base:stable"
    steps:
      - run: sudo apt-get update -qq && sudo apt install curl gettext-base
      - slack/notify:
          event: pass
          template: basic_success_1
      - ms-teams/report:
          only_on_fail: false
          webhook_url: $MS_TEAMS_WEBHOOK_URL
workflows:
  version: 2
  opencti:
    jobs:
      - ensure_formatting
      - linter
      - test
      - build_1:
          filters:
            tags:
              only: /[0-9]+(\.[0-9]+)+(\.[0-9]+)*/
            branches:
              ignore: /.*/
      - build_2:
          filters:
            tags:
              only: /[0-9]+(\.[0-9]+)+(\.[0-9]+)*/
            branches:
              ignore: /.*/
      - build_fips_1:
          filters:
            tags:
              only: /[0-9]+(\.[0-9]+)+(\.[0-9]+)*/
            branches:
              ignore: /.*/
      - build_rolling_1:
          requires:
            - ensure_formatting
            - linter
          filters:
            branches:
              only:
                - master
      - build_rolling_2:
          requires:
            - ensure_formatting
            - linter
          filters:
            branches:
              only:
                - master
      - build_fips_rolling_1:
          requires:
            - ensure_formatting
            - linter
          filters:
            branches:
              only:
                - master
      - notify_rolling:
          requires:
            - build_rolling_1
            - build_rolling_2
            - build_fips_rolling_1
      - notify:
          requires:
            - build_1
            - build_2
            - build_fips_1
          filters:
            tags:
              only: /[0-9]+(\.[0-9]+)+(\.[0-9]+)*/
            branches:
              ignore: /.*/
