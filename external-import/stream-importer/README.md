# Stream Importer Connector

This connector fetches events stored in minio and sends them to RabbitMQ to be ingested by OpenCTI. The files containing the events must have been generated by the [stream-exporter](../../stream/stream-exporter/) connector. This is used when wanting to replicate an OpenCTI instance with another one when the two instances cannot be connected to each other. The user that runs the `stream-importer` connector will be set as the creator of the objects.

The state of the connector contains the file count of the last ingested file and the order is checked before importing a file.

When an event file is processed, it is moved to another bucket.

## Installation

### Requirements

- OpenCTI Platform >= 6.3.4

### Configuration

| Parameter                    | Docker envvar                    | Mandatory | Description                                                                                                                                                                   |
|------------------------------|----------------------------------|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `opencti_url`                | `OPENCTI_URL`                    | Yes       | The URL of the OpenCTI platform. Note that final `/` should be avoided. Example value: `http://opencti:8080`                                                                  |
| `opencti_token`              | `OPENCTI_TOKEN`                  | Yes       | The default admin token configured in the OpenCTI platform parameters file.                                                                                                   |
| `connector_id`               | `CONNECTOR_ID`                   | Yes       | A valid arbitrary `UUIDv4` that must be unique for this connector.                                                                                                            |
| `connector_name`             | `CONNECTOR_NAME`                 | Yes       | A connector name to be shown in OpenCTI.                                                                                                                                      |
| `connector_scope`            | `CONNECTOR_SCOPE`                | Yes       | Supported scope. E. g., `text/html`.                                                                                                                                          |
| `connector_confidence_level` | `CONNECTOR_CONFIDENCE_LEVEL`     | Yes       | The default confidence level for created sightings (a number between 1 and 4).                                                                                                |
| `connector_log_level`        | `CONNECTOR_LOG_LEVEL`            | Yes       | The log level for this connector, could be `debug`, `info`, `warn` or `error` (less verbose).                                                                                 |
| `interval`                   | `CONNECTOR_RUN_EVERY`            | Yes       | The time unit is represented by a single character at the end of the string: d for days, h for hours, m for minutes, and s for seconds. e.g., 30s is 30 seconds. 1d is 1 day. |
| `update_existing_data`       | `CONNECTOR_UPDATE_EXISTING_DATA` | Yes       | Whether to update known existing data.                                                                                                                                        |
| `perfect_sync`               | `PERFECT_SYNC`                   | Yes       | If set, events received can overwrite data, default `true`.                                                                                                                   |
| `minio_endpoint`             | `MINIO_ENDPOINT`                 | Yes       | The minio endpoint to read the messages from.                                                                                                                                 |
| `minio_port`                 | `MINIO_PORT`                     | Yes       | The minio port.                                                                                                                                                               |
| `minio_bucket`               | `MINIO_BUCKET`                   | Yes       | The minio bucket to read the messages from.                                                                                                                                   |
| `minio_folder`               | `MINIO_FOLDER`                   | Yes       | The minio folder containing the files to import.                                                                                                                              |
| `minio_bucket_done`          | `MINIO_BUCKET_DONE`              | Yes       | The minio bucket to move the messages that have been processed.                                                                                                               |
| `minio_access_key`           | `MINIO_ACCESS_KEY`               | Yes       | The minio access key.                                                                                                                                                         |
| `minio_secret_key`           | `MINIO_SECRET_KEY`               | Yes       | The minio secret key.                                                                                                                                                         |
| `minio_secure`               | `MINIO_SECURE`                   | No        | Whether to use SSL of not, default False.                                                                                                                                     |
| `minio_cert_check`           | `MINIO_CERT_CHECK`               | No        | Whether to check certificate.                                                                                                                                                 |
