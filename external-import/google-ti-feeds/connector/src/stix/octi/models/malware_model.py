"""The module contains the OctiMalwareModel class, which represents an OpenCTI Malware."""

from datetime import datetime
from typing import Any, List, Optional

from connector.src.stix.v21.models.cdts.kill_chain_phase_model import (
    KillChainPhaseModel,
)
from connector.src.stix.v21.models.ovs.malware_type_ov_enums import MalwareTypeOV
from connector.src.stix.v21.models.sdos.malware_model import MalwareModel


class OctiMalwareModel:
    """Model for creating OpenCTI Malware objects."""

    @staticmethod
    def create(
        name: str,
        organization_id: str,
        marking_ids: list[str],
        malware_types: List[MalwareTypeOV],
        is_family: bool = True,
        description: Optional[str] = None,
        aliases: Optional[List[str]] = None,
        first_seen: Optional[datetime] = None,
        last_seen: Optional[datetime] = None,
        kill_chain_phases: Optional[List[KillChainPhaseModel]] = None,
        labels: Optional[List[str]] = None,
        **kwargs: Any,
    ) -> MalwareModel:
        """Create a Malware model.

        Args:
            name: The name of the malware
            organization_id: The ID of the organization that created this malware
            marking_ids: List of marking definition IDs to apply to the malware
            malware_types: List of malware types
            is_family: Whether this is a malware family (True) or instance (False)
            description: Description of the malware
            aliases: Alternative names for the malware
            first_seen: First time the malware was observed
            last_seen: Last time the malware was observed
            kill_chain_phases: Kill chain phases associated with the malware
            labels: Labels to apply to the malware
            **kwargs: Additional arguments to pass to MalwareModel

        Returns:
            MalwareModel: The created malware model

        """
        data = {
            "type": "malware",
            "spec_version": "2.1",
            "created": kwargs.pop("created", datetime.now()),
            "modified": kwargs.pop("modified", datetime.now()),
            "name": name,
            "description": description,
            "malware_types": malware_types,
            "is_family": is_family,
            "aliases": aliases,
            "first_seen": first_seen,
            "last_seen": last_seen,
            "kill_chain_phases": kill_chain_phases,
            "labels": labels,
            "created_by_ref": organization_id,
            "object_marking_refs": marking_ids,
            **kwargs,
        }

        return MalwareModel(**data)
