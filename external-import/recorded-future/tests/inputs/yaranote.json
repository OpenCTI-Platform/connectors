{
    "attributes":
    {
        "attachment_content": "rule MAL_DarkGate_LNK\n{\n    meta:\n        author = \"CNANCE, Insikt Group, Recorded Future\"\n        date = \"2023-09-11\"\n        description = \"Detects DarkGate LNK loader samples based on strings and metadata\"\n        version = \"1.0\"\n        reference = \"https://twitter.com/malwrhunterteam/status/1701160900386820220\"\n        hash = \"62c10a69e945fe29209ff9ccee0b0b7f57669d86c74bef53ac4f303c1231ea1a\"\n        hash = \"0c439d6f8777e97c6d1414f42a5ba79efb3a8eef78f4a6c87857a30766eed0e9\"\n        hash = \"0299cdc44b480680707ff16a4b7299fd9e368a0130319dba0af7c5553f992334\"\n        hash = \"2c6af12f603743fcc3effdc24783c969c906816960fbfbf012974fc04722a679\"\n        hash = \"0fe9747c2987d2a39be01db0f233b31bfa2c8592d1f220c4877859e98ff32a12\"\n        hash = \"670143bb7db44fc7f58dee50efd7470f45a1f36c421d2fbb3f1751a3428f23a9\"\n        hash = \"0df969aec2ade7b328bec0c98e16c268c0b97bafe0907c8129ff6411d7fff0a3\"\n        hash = \"64302a1987273c3eaa118c77295c7b15226ed753f5eef74a071ee3a136c75a31\"\n        hash = \"6d1b39599a514c857318c8532dad0f429bee95ad3a59cb6681b3420bcc284f84\"\n        hash = \"5b01ad121191d7178c4409eafbe42ae1b040e08ff446bcc45da2ca4045d0a209\"\n        hash = \"0da725817af1dc8403ccd49eb654e05de1e65e9ce9b37b5d6b1eb322170c07ad\"\n        hash = \"0f291f94513d29fef8802f4813a337b7b308b49a363e8ea1ca4d188a6c8114c1\"\n        hash = \"bcd449470626f4f34a15be00812f850c5e032723e35776fb4b9be6c7be6c8913\"\n        hash = \"263349f8dc1fd418cb66257ffa87cd93111317af98ced3eb4e61b80d54a6c566\"\n        RF_MALWARE = \"DarkGate\"\n        RF_MALWARE_ID = \"YGjwOY\"\n\n    strings:\n        $d1 = { 89 90 f5 f0 } \n        $d2 = { 67 40 da 10 }\n\n        $s1 = \"WINHTTP.WinHTTPRequest\" wide\n        $s2 = \"Shell.Application\" wide\n        $s3 = \".ShellExecute\" wide\n        $s4 = \"CreateObject(\" wide\n        $s5 = \":.Open ^\\\"get^\\\"\" wide\n        $s6 = \"= .responseText\" wide\n        $s7 = \"mkdir\" wide\n        $s8 = \"echo \" wide\n        $s9 = \"http\" wide\n\n    condition:\n        uint32(0) == 0x0000004c and // lnk file\n        filesize < 10KB and\n        (uint32(0x14) >> 1) & 0x1 == 0x1 and // HasLinkInfo flag\n        for any of ($d*): ($ at (0x4e + uint16(0x4c) + uint32(0x4e + uint16(0x4c) + 0xc) + 0x8)) and // drive serial number\n        all of ($s*)\n}",
        "attachment_type": "yara",
        "validated_on": "2023-09-11T22:26:25.030Z",
        "published": "2023-09-12T15:16:39.634Z",
        "text": "On September 6, 2023, TrueSec Cybersecurity Incident Response Team (CSIRT) published an article outlining their investigation into a Microsoft Teams campaign that took place on August 29, 2023. This campaign was responsible for disseminating DarkGate malware. The attackers operated through 2 compromised external Office 365 accounts, employing social engineering tactics to deceive victims into downloading a malicious ZIP file from a SharePoint URL. The ZIP file contains a malicious LNK file, which serves to execute a VBS script, subsequently initiating the download and execution of AutoIt3 with an AutoIt script. This AutoIt script deobfuscates and injects shellcode, ultimately leading to the execution of the final DarkGate payload. Insikt Group created a YARA rule that can be used to detect the malicious LNK files used to initiate the DarkGate infection, which can be found attached to this note.\n\nIOCs\n\nCompromised Email Accounts\n63090101@my.buu.ac.th\nadriverar@unadvirtual.edu.co\n\nC2 Address\nhXXp://5.188.87.58:2351\n\nSHA256 Hashes\n0c59f568da43731e3212b6461978e960644be386212cc448a715dbf3f489d758\nbcd449470626f4f34a15be00812f850c5e032723e35776fb4b9be6c7be6c8913\n4c21711de81bb5584d35e744394eed2f36fef0d93474dfc5685665a9e159eef1\n1bcde4d4613f046b63e970aa10ea2662d8aa7d326857128b59cb88484cce9a2d",
        "attachment": "MAL_DarkGate_LNK.yar",
        "topic":
        [
            {
                "id": "ZjnoP2",
                "name": "Hunting Package",
                "type": "Topic",
                "description": "Technical detection and mitigations for specific malware, including YARA or Snort rules."
            },
            {
                "id": "VTrvnW",
                "name": "YARA Rule",
                "type": "Topic",
                "description": "Rules for identifying malware samples through pattern recognition."
            }
        ],
        "context_entities":
        [
            {
                "id": "idn:unadvirtualedu-my.sharepoint.com",
                "name": "unadvirtualedu-my.sharepoint.com",
                "type": "InternetDomainName"
            },
            {
                "id": "email:adriverar@unadvirtual.edu.co",
                "name": "adriverar@unadvirtual.edu.co",
                "type": "EmailAddress"
            },
            {
                "id": "email:63090101@my.buu.ac.th",
                "name": "63090101@my.buu.ac.th",
                "type": "EmailAddress"
            },
            {
                "id": "idn:burapha-my.sharepoint.com",
                "name": "burapha-my.sharepoint.com",
                "type": "InternetDomainName"
            },
            {
                "id": "B_E7B",
                "name": "Microsoft",
                "type": "Company"
            },
            {
                "id": "hash:4c21711de81bb5584d35e744394eed2f36fef0d93474dfc5685665a9e159eef1",
                "name": "4c21711de81bb5584d35e744394eed2f36fef0d93474dfc5685665a9e159eef1",
                "type": "Hash"
            },
            {
                "id": "hash:0c59f568da43731e3212b6461978e960644be386212cc448a715dbf3f489d758",
                "name": "0c59f568da43731e3212b6461978e960644be386212cc448a715dbf3f489d758",
                "type": "Hash"
            },
            {
                "id": "hash:bcd449470626f4f34a15be00812f850c5e032723e35776fb4b9be6c7be6c8913",
                "name": "bcd449470626f4f34a15be00812f850c5e032723e35776fb4b9be6c7be6c8913",
                "type": "Hash"
            },
            {
                "id": "hash:1bcde4d4613f046b63e970aa10ea2662d8aa7d326857128b59cb88484cce9a2d",
                "name": "1bcde4d4613f046b63e970aa10ea2662d8aa7d326857128b59cb88484cce9a2d",
                "type": "Hash"
            }
        ],
        "validation_urls":
        [
            {
                "id": "url:https://www.truesec.com/hub/blog/darkgate-loader-delivered-via-teams",
                "name": "https://www.truesec.com/hub/blog/darkgate-loader-delivered-via-teams",
                "type": "URL"
            }
        ],
        "title": "Microsoft Teams used to Deliver DarkGate Malware",
        "note_entities":
        [
            {
                "id": "J4WbXT",
                "name": "Social Engineering",
                "type": "AttackVector"
            },
            {
                "id": "0eyAM",
                "name": "Phishing",
                "type": "AttackVector"
            },
            {
                "id": "ip:5.188.87.58",
                "name": "5.188.87.58",
                "type": "IpAddress"
            },
            {
                "id": "YGjwOY",
                "name": "DarkGate",
                "type": "Malware"
            },
            {
                "id": "rcfdOI",
                "name": "DarkGate Loader",
                "type": "Malware"
            },
            {
                "id": "mitre:T1566.002",
                "name": "T1566.002",
                "type": "MitreAttackIdentifier"
            },
            {
                "id": "mitre:T1204.002",
                "name": "T1204.002",
                "type": "MitreAttackIdentifier"
            },
            {
                "id": "mitre:T1055",
                "name": "T1055",
                "type": "MitreAttackIdentifier"
            },
            {
                "id": "JsTAK6",
                "name": "Microsoft Teams",
                "type": "Product"
            },
            {
                "id": "mitre:T1586.002",
                "name": "T1586.002",
                "type": "MitreAttackIdentifier"
            }
        ]
    },
    "source":
    {
        "id": "source:VKz42X",
        "name": "Insikt Group",
        "type": "Source"
    },
    "id": "sqk59z"
}
