from typing import List

import pycti
import stix2
from stix2 import ExternalReference
from open_cti import vulnerability
from stix2 import Vulnerability as StixVulnerability
from zerofox.domain.vulnerabilities import Vulnerability


def vulnerability_to_vulnerability(
    created_by, now: str, entry: Vulnerability
) -> List[stix2.Vulnerability]:
    """
    Based on a ZeroFox Vulnerability object, creates a STIX Vulnerability object.
    """
    summary = f"\n\nSummary: {entry.summary}" if entry.summary else ""
    remediation = f"\n\nRemediation: {entry.remediation}" if entry.remediation else ""

    vuln = vulnerability(
        id=pycti.Vulnerability.generate_id(entry.cve),
        cve=entry.cve,
        description=f"{entry.description}{summary}{remediation}",
        created=now,
        modified=entry.updated_at,
        created_by_ref=created_by,
    )
    return [vuln]
